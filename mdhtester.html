<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MDH TESTER ‚Äî Ultimate API Key Tester</title>
    <meta name="description" content="Paste 1000+ mixed API keys, auto-detect 85+ providers, bulk test with pause/resume, filter working/invalid, export results. Free tool by MDHojayfa.">
    <meta property="og:title" content="MDH TESTER ‚Äî Ultimate Bulk API Key Tester">
    <meta property="og:description" content="Test 1000+ API keys at once. Auto-detect providers. Filter working keys. Export results.">
    <meta property="og:url" content="https://mdhojayfa.github.io/mdhtester.html">
    <meta name="theme-color" content="#6366f1">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{--bg:#0a0a0c;--surface:#111114;--surface2:#19191d;--surface3:#222228;--border:#2a2a30;--border2:#3a3a42;--text:#f0f0f5;--text2:#9898a8;--text3:#55556a;--accent:#6366f1;--accent2:#818cf8;--accent3:#a5b4fc;--green:#22c55e;--green2:#16a34a;--red:#ef4444;--yellow:#eab308;--blue:#3b82f6;--purple:#a855f7;--cyan:#06b6d4;--pink:#ec4899;--orange:#f97316;--radius:12px;--shadow:0 1px 3px rgba(0,0,0,.4)}
        [data-theme="light"]{--bg:#f8f8fa;--surface:#ffffff;--surface2:#f0f0f4;--surface3:#e4e4ea;--border:#d0d0d8;--border2:#a0a0aa;--text:#0a0a0c;--text2:#55556a;--text3:#9898a8;--shadow:0 1px 3px rgba(0,0,0,.08)}
        html{scroll-behavior:smooth}
        body{font-family:'Inter',system-ui,sans-serif;background:var(--bg);color:var(--text);min-height:100vh;-webkit-font-smoothing:antialiased;line-height:1.6;overflow-x:hidden}
        .mono{font-family:'JetBrains Mono',monospace}
        ::selection{background:rgba(99,102,241,.3)}
        ::-webkit-scrollbar{width:5px;height:5px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:var(--border2);border-radius:10px}

        .container{max-width:900px;margin:0 auto;padding:0 20px}
        @media(max-width:640px){.container{padding:0 12px}}

        /* Header */
        .header{position:sticky;top:0;z-index:40;background:color-mix(in srgb,var(--bg) 82%,transparent);backdrop-filter:blur(20px) saturate(1.8);border-bottom:1px solid var(--border)}
        .header-inner{display:flex;align-items:center;justify-content:space-between;height:54px}
        .logo{display:flex;align-items:center;gap:10px;text-decoration:none;color:var(--text)}
        .logo-mark{width:30px;height:30px;border-radius:8px;background:linear-gradient(135deg,#6366f1,#a855f7);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:900;font-size:13px;box-shadow:0 2px 8px rgba(99,102,241,.3)}
        .logo-text{font-size:14px;font-weight:800;letter-spacing:-.02em}
        .logo-badge{font-size:8px;background:rgba(99,102,241,.12);color:var(--accent2);padding:1px 5px;border-radius:4px;font-weight:700}
        .header-actions{display:flex;align-items:center;gap:2px}
        .icon-btn{width:34px;height:34px;border-radius:8px;border:1px solid var(--border);background:var(--surface);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .15s;font-size:14px;color:var(--text2);position:relative}
        .icon-btn:hover{border-color:var(--border2);background:var(--surface2);color:var(--text);transform:translateY(-1px)}

        /* Cards */
        .card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);transition:border-color .2s}
        .card:hover{border-color:var(--border2)}

        /* Inputs */
        .input{width:100%;background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:9px 12px;font-size:12px;color:var(--text);outline:none;transition:all .2s;font-family:inherit}
        .input:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(99,102,241,.1)}
        .input::placeholder{color:var(--text3)}
        .input-mono{font-family:'JetBrains Mono',monospace;font-size:11px}
        textarea.input{resize:vertical;line-height:1.7}
        select.input{cursor:pointer;-webkit-appearance:none;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%2355556a' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 10px center}

        /* Buttons */
        .btn{display:inline-flex;align-items:center;justify-content:center;gap:6px;padding:9px 18px;border-radius:8px;font-size:12px;font-weight:600;cursor:pointer;transition:all .15s;border:none;font-family:inherit;white-space:nowrap}
        .btn:active{transform:scale(.97)}
        .btn-primary{background:var(--accent);color:#fff;box-shadow:0 1px 2px rgba(99,102,241,.3)}
        .btn-primary:hover{background:#5558e6;box-shadow:0 4px 12px rgba(99,102,241,.25);transform:translateY(-1px)}
        .btn-primary:disabled{opacity:.3;cursor:not-allowed;transform:none!important;box-shadow:none!important}
        .btn-secondary{background:var(--surface2);color:var(--text2);border:1px solid var(--border)}
        .btn-secondary:hover{border-color:var(--border2);color:var(--text);background:var(--surface3)}
        .btn-success{background:var(--green);color:#fff;box-shadow:0 1px 2px rgba(34,197,94,.3)}
        .btn-success:hover{background:var(--green2);transform:translateY(-1px)}
        .btn-success:disabled{opacity:.3;cursor:not-allowed;transform:none!important}
        .btn-danger{background:transparent;color:var(--red);border:1px solid rgba(239,68,68,.2)}
        .btn-danger:hover{background:rgba(239,68,68,.05)}
        .btn-sm{padding:6px 12px;font-size:11px;border-radius:7px}
        .btn-xs{padding:4px 10px;font-size:10px;border-radius:6px}
        .btn-ghost{background:transparent;color:var(--text2);border:1px solid transparent}
        .btn-ghost:hover{background:var(--surface2);color:var(--text)}

        /* Tabs */
        .tabs{display:inline-flex;gap:2px;background:var(--surface2);padding:3px;border-radius:9px;border:1px solid var(--border)}
        .tab{padding:7px 14px;border-radius:7px;font-size:11px;font-weight:600;cursor:pointer;transition:all .15s;color:var(--text3);background:transparent;border:none;font-family:inherit}
        .tab.active{background:var(--surface);color:var(--text);box-shadow:var(--shadow)}
        .tab:hover:not(.active){color:var(--text2)}
        @media(max-width:640px){.tab{padding:7px 10px;font-size:10px}}

        /* Chips & Pills */
        .chip{display:inline-flex;align-items:center;gap:4px;padding:5px 11px;border-radius:20px;font-size:10px;font-weight:600;cursor:pointer;transition:all .15s;background:var(--surface2);border:1px solid var(--border);color:var(--text2)}
        .chip:hover{border-color:var(--border2);color:var(--text)}
        .chip.active{background:rgba(99,102,241,.08);border-color:rgba(99,102,241,.25);color:var(--accent2)}
        .pill{display:inline-flex;align-items:center;gap:5px;padding:5px 12px;border-radius:20px;font-size:10px;font-weight:600;cursor:pointer;transition:all .15s;background:var(--surface2);border:1px solid var(--border);color:var(--text2)}
        .pill:hover{border-color:var(--border2);color:var(--text)}
        .pill.active{border-color:rgba(99,102,241,.3);background:rgba(99,102,241,.06);color:var(--accent2)}
        .pill-count{font-weight:800;min-width:14px;text-align:center}

        .label{display:block;font-size:9px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:.08em;margin-bottom:5px}
        .badge{display:inline-flex;align-items:center;padding:2px 7px;border-radius:5px;font-size:9px;font-weight:700}
        .badge-green{background:rgba(34,197,94,.1);color:var(--green)}.badge-red{background:rgba(239,68,68,.1);color:var(--red)}.badge-yellow{background:rgba(234,179,8,.1);color:var(--yellow)}.badge-blue{background:rgba(59,130,246,.1);color:var(--blue)}.badge-purple{background:rgba(99,102,241,.1);color:var(--accent2)}.badge-cyan{background:rgba(6,182,212,.1);color:var(--cyan)}.badge-orange{background:rgba(249,115,22,.1);color:var(--orange)}

        /* Stats */
        .stat-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:6px}
        .stat-card{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:12px 8px;text-align:center;transition:all .2s}
        .stat-card:hover{border-color:var(--border2)}
        .stat-value{font-size:22px;font-weight:800;letter-spacing:-.03em;line-height:1.1}
        .stat-label{font-size:8px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:.06em;margin-top:2px}
        @media(max-width:640px){.stat-value{font-size:16px}.stat-card{padding:8px 4px}}

        /* Spinner & Progress */
        .spinner{width:14px;height:14px;border:2px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin .6s linear infinite;display:inline-block;vertical-align:middle}
        @keyframes spin{to{transform:rotate(360deg)}}
        .progress-bar{width:100%;height:5px;background:var(--surface2);border-radius:5px;overflow:hidden}
        .progress-fill{height:100%;border-radius:5px;transition:width .3s ease;background:linear-gradient(90deg,var(--accent),var(--green))}
        .progress-segments{display:flex;height:3px;border-radius:3px;overflow:hidden;gap:1px;margin-top:5px}

        /* Results table */
        .result-row{display:grid;grid-template-columns:28px 1.3fr 1fr 80px 65px 28px;align-items:center;gap:5px;padding:7px 10px;border-radius:7px;font-size:11px;transition:all .12s;cursor:pointer}
        .result-row:hover{background:var(--surface2)}
        .result-row.row-header{font-size:8px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:.06em;padding:5px 10px;cursor:default}
        .result-row.row-header>span{cursor:pointer}.result-row.row-header>span:hover{color:var(--accent2)}
        .result-row.row-valid{border-left:2px solid var(--green);background:rgba(34,197,94,.015)}
        .result-row.row-invalid{border-left:2px solid var(--red);background:rgba(239,68,68,.015)}
        .result-row.row-error{border-left:2px solid var(--yellow);background:rgba(234,179,8,.015)}
        .result-row.row-testing{border-left:2px solid var(--accent);background:rgba(99,102,241,.02)}
        @media(max-width:640px){.result-row{grid-template-columns:22px 1fr 68px 55px 26px;font-size:10px;gap:3px}.result-row .col-prov{display:none}}

        /* Expand detail */
        .expand-detail{overflow:hidden;max-height:0;transition:max-height .3s ease,padding .3s ease;padding:0 10px;background:var(--surface2);border-radius:0 0 8px 8px;margin:-3px 0 3px}
        .expand-detail.open{max-height:600px;padding:12px 10px}
        .expand-response{background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:10px;font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--text2);max-height:280px;overflow-y:auto;white-space:pre-wrap;word-break:break-all;line-height:1.5;margin-top:8px}

        /* Drop zone */
        .drop-zone{border:2px dashed var(--border);border-radius:var(--radius);transition:all .3s}
        .drop-zone.active{border-color:var(--accent);background:rgba(99,102,241,.03)}

        /* Provider stats */
        .prov-stat{display:flex;align-items:center;gap:7px;padding:7px 9px;border-radius:7px;background:var(--surface2);border:1px solid var(--border);font-size:10px;transition:all .15s}
        .prov-stat:hover{border-color:var(--border2)}
        .prov-stat-bar{flex:1;height:3px;background:var(--border);border-radius:3px;overflow:hidden;min-width:30px}
        .prov-stat-fill{height:100%;border-radius:3px;transition:width .5s ease}
        .prov-stats-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(190px,1fr));gap:5px}
        @media(max-width:480px){.prov-stats-grid{grid-template-columns:1fr}}

        /* Donut */
        .donut{width:70px;height:70px;border-radius:50%;position:relative;display:flex;align-items:center;justify-content:center}
        .donut-hole{width:50px;height:50px;border-radius:50%;background:var(--surface);display:flex;align-items:center;justify-content:center;flex-direction:column;position:absolute}
        .donut-pct{font-size:14px;font-weight:800;line-height:1}
        .donut-label{font-size:7px;font-weight:600;color:var(--text3);text-transform:uppercase;margin-top:1px}

        /* Modals */
        .modal-wrap{position:fixed;inset:0;z-index:100;display:flex;align-items:center;justify-content:center;padding:20px;opacity:0;pointer-events:none;transition:opacity .2s;background:rgba(0,0,0,.5);backdrop-filter:blur(4px)}
        .modal-wrap.active{opacity:1;pointer-events:auto}
        .modal{background:var(--surface);border:1px solid var(--border);border-radius:14px;width:100%;max-width:480px;max-height:85vh;overflow-y:auto;transform:scale(.95) translateY(8px);transition:transform .25s cubic-bezier(.4,0,.2,1);box-shadow:0 24px 48px rgba(0,0,0,.3)}
        .modal-wrap.active .modal{transform:scale(1) translateY(0)}
        .modal-header{display:flex;align-items:center;justify-content:space-between;padding:18px 20px 0}
        .modal-body{padding:14px 20px 20px}
        .close-btn{background:none;border:none;color:var(--text3);font-size:16px;cursor:pointer;width:30px;height:30px;border-radius:7px;display:flex;align-items:center;justify-content:center;transition:all .15s}
        .close-btn:hover{background:var(--surface2);color:var(--text)}

        /* Side panel */
        .overlay{position:fixed;inset:0;background:rgba(0,0,0,.4);backdrop-filter:blur(2px);z-index:50;opacity:0;pointer-events:none;transition:opacity .2s}
        .overlay.active{opacity:1;pointer-events:auto}
        .side-panel{position:fixed;top:0;right:0;height:100%;width:100%;max-width:360px;background:var(--surface);border-left:1px solid var(--border);z-index:60;transform:translateX(100%);transition:transform .3s cubic-bezier(.4,0,.2,1);overflow-y:auto}
        .side-panel.open{transform:translateX(0)}

        /* Toast */
        .toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%) translateY(80px);z-index:999;opacity:0;pointer-events:none;transition:all .3s cubic-bezier(.4,0,.2,1)}
        .toast.show{transform:translateX(-50%) translateY(0);opacity:1}
        .toast-inner{background:var(--surface);border:1px solid var(--border);border-radius:9px;padding:9px 16px;display:flex;align-items:center;gap:7px;box-shadow:0 8px 32px rgba(0,0,0,.3);font-size:12px;font-weight:500}

        /* Result card */
        .result-card{border-radius:var(--radius);overflow:hidden}
        .result-card.res-valid{border-color:rgba(34,197,94,.2)}.result-card.res-invalid{border-color:rgba(239,68,68,.2)}.result-card.res-error{border-color:rgba(234,179,8,.2)}
        .res-body{background:var(--surface2);border:1px solid var(--border);border-radius:9px;max-height:300px;overflow-y:auto;padding:12px;font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--text2);line-height:1.6;white-space:pre-wrap;word-break:break-all}

        /* JSON viewer */
        .jk{color:#818cf8}.js{color:#34d399}.jn{color:#60a5fa}.jb{color:#f59e0b}.jnl{color:var(--text3)}
        .jt{cursor:pointer;user-select:none;display:inline-block;width:14px;text-align:center;color:var(--accent);font-weight:bold;font-size:9px}
        .jcoll{margin-left:14px;border-left:1px solid var(--border);padding-left:8px}
        .jchid{display:none}

        /* Service grid */
        .svc-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(125px,1fr));gap:5px}
        .svc-card{display:flex;align-items:center;gap:7px;padding:9px 10px;border-radius:9px;cursor:pointer;transition:all .15s;background:var(--surface);border:1px solid var(--border)}
        .svc-card:hover{border-color:var(--accent);background:rgba(99,102,241,.025);transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,0,0,.08)}
        .svc-icon{font-size:15px;flex-shrink:0}
        .svc-name{font-size:10px;font-weight:600;color:var(--text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
        .svc-cat{font-size:8px;color:var(--text3)}

        /* Settings */
        .settings-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:7px}
        @media(max-width:640px){.settings-grid{grid-template-columns:repeat(2,1fr)}}
        .deep-config{display:grid;grid-template-columns:1fr 1fr 1fr;gap:7px;margin-top:8px;padding:10px;background:var(--surface2);border:1px solid var(--border);border-radius:9px}
        @media(max-width:480px){.deep-config{grid-template-columns:1fr}}

        /* Consent */
        .consent-overlay{position:fixed;inset:0;z-index:200;background:var(--bg);display:flex;align-items:center;justify-content:center;padding:20px}

        .section{margin-bottom:16px}
        .divider{height:1px;background:var(--border);margin:14px 0}

        /* Helpers */
        .flex{display:flex}.items-center{align-items:center}.justify-between{justify-content:space-between}.justify-center{justify-content:center}
        .gap-1{gap:4px}.gap-2{gap:7px}.gap-3{gap:10px}.gap-4{gap:14px}
        .flex-wrap{flex-wrap:wrap}.flex-1{flex:1}.w-full{width:100%}
        .text-center{text-align:center}.truncate{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
        .hidden{display:none!important}
        .mt-1{margin-top:4px}.mt-2{margin-top:7px}.mt-3{margin-top:10px}.mb-2{margin-bottom:7px}.mb-3{margin-bottom:10px}
        .p-4{padding:14px}.p-5{padding:18px}
        .two-col{display:grid;grid-template-columns:1fr 1fr;gap:8px}
        @media(max-width:480px){.two-col{grid-template-columns:1fr}}

        @keyframes fadeUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
        @keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
        .anim-in{animation:fadeUp .4s ease forwards}
        .pulse{animation:pulse 1.5s ease infinite}
        .vscroll{max-height:520px;overflow-y:auto}

        input[type="range"]{-webkit-appearance:none;width:100%;height:3px;background:var(--border);border-radius:3px;outline:none}
        input[type="range"]::-webkit-slider-thumb{-webkit-appearance:none;width:14px;height:14px;border-radius:50%;background:var(--accent);cursor:pointer;box-shadow:0 1px 4px rgba(99,102,241,.3)}

        #confettiCanvas{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:300}
        .sound-btn.muted{opacity:.35}

        .mega-search{position:relative}
        .mega-search svg{position:absolute;left:9px;top:50%;transform:translateY(-50%);width:11px;height:11px;color:var(--text3)}
        .mega-search input{padding-left:28px;height:32px;font-size:11px}

        /* Inline toggle */
        .toggle-row{display:flex;align-items:center;gap:8px;padding:8px 12px;background:var(--surface2);border:1px solid var(--border);border-radius:8px;cursor:pointer;transition:all .15s;user-select:none}
        .toggle-row:hover{border-color:var(--border2)}
        .toggle-row.on{border-color:var(--accent);background:rgba(99,102,241,.04)}
        .toggle-row input{accent-color:var(--accent);width:13px;height:13px;flex-shrink:0}
        .toggle-row span{font-size:11px;font-weight:600;color:var(--text2)}
        .toggle-row.on span{color:var(--accent2)}

        /* Byte size */
        .size-badge{font-size:9px;color:var(--text3);font-weight:500;font-family:'JetBrains Mono',monospace}
    </style>
</head>
<body>

<canvas id="confettiCanvas"></canvas>

<!-- CONSENT -->
<div id="consent" class="consent-overlay">
    <div style="max-width:360px;width:100%;text-align:center" class="anim-in">
        <div class="logo-mark" style="width:48px;height:48px;font-size:20px;border-radius:12px;margin:0 auto 14px">M</div>
        <h1 style="font-size:22px;font-weight:900;margin-bottom:3px;letter-spacing:-.03em">MDH TESTER</h1>
        <p style="font-size:11px;color:var(--text3);margin-bottom:24px">Ultimate API Key Tester ¬∑ v5.0</p>
        <div class="card p-4" style="text-align:left;margin-bottom:18px">
            <p style="font-size:11px;font-weight:700;color:var(--yellow);margin-bottom:8px">‚ö†Ô∏è Important</p>
            <ul style="font-size:10px;color:var(--text2);list-style:none;display:flex;flex-direction:column;gap:6px">
                <li>‚Üí All tests run <strong style="color:var(--text)">client-side</strong> ‚Äî keys never leave your browser</li>
                <li>‚Üí Only test keys <strong style="color:var(--text)">you own</strong> or have permission to test</li>
                <li>‚Üí <strong style="color:var(--text)">85+ providers</strong> with auto-detection ¬∑ <strong style="color:var(--text)">Deep test</strong> with custom prompts</li>
                <li>‚Üí Paste <strong style="color:var(--text)">1000+ keys</strong> for bulk testing with full JSON response</li>
            </ul>
        </div>
        <label style="display:flex;align-items:flex-start;gap:9px;text-align:left;margin-bottom:18px;cursor:pointer">
            <input type="checkbox" id="consentChk" onchange="document.getElementById('consentBtn').disabled=!this.checked" style="accent-color:var(--accent);width:15px;height:15px;margin-top:1px;flex-shrink:0">
            <span style="font-size:10px;color:var(--text2);line-height:1.5">I confirm I own or have authorization to test the API keys I enter.</span>
        </label>
        <button id="consentBtn" onclick="acceptConsent()" disabled class="btn btn-primary w-full" style="padding:12px;font-size:13px">Launch MDH TESTER ‚Üí</button>
        <p style="font-size:9px;color:var(--text3);margin-top:18px">by <strong style="color:var(--accent2)">MDHojayfa</strong> ¬∑ <a href="https://t.me/MDHojayfa_bot" target="_blank" style="color:var(--blue);text-decoration:none">@MDHojayfa_bot</a></p>
    </div>
</div>

<!-- HEADER -->
<header class="header">
    <div class="container header-inner">
        <a class="logo" href="#">
            <div class="logo-mark">M</div>
            <span class="logo-text">MDH TESTER</span>
            <span class="logo-badge">v5</span>
        </a>
        <div class="header-actions">
            <button onclick="toggleSound()" class="icon-btn sound-btn" id="soundBtn" title="Sound">üîî</button>
            <button onclick="openModal('shareModal')" class="icon-btn" title="Share">üì§</button>
            <button onclick="openModal('scanModal')" class="icon-btn" title="Scan">üîç</button>
            <a href="https://t.me/MDHojayfa_bot" target="_blank" class="icon-btn" title="Telegram" style="text-decoration:none">‚úàÔ∏è</a>
            <button onclick="toggleHist()" class="icon-btn" title="History">üïê</button>
            <button onclick="toggleTheme()" class="icon-btn" title="Theme"><span id="themeIco">üåô</span></button>
        </div>
    </div>
</header>

<!-- MAIN -->
<div class="container" style="padding-top:16px;padding-bottom:50px">

    <!-- Stats -->
    <div class="stat-grid section anim-in">
        <div class="stat-card"><div class="stat-value" style="color:var(--accent)" id="stTotal">0</div><div class="stat-label">Tests</div></div>
        <div class="stat-card"><div class="stat-value" style="color:var(--green)" id="stValid">0</div><div class="stat-label">Valid</div></div>
        <div class="stat-card"><div class="stat-value" style="color:var(--red)" id="stInvalid">0</div><div class="stat-label">Invalid</div></div>
        <div class="stat-card"><div class="stat-value" style="color:var(--blue)" id="stAvg">0</div><div class="stat-label">Avg ms</div></div>
        <div class="stat-card"><div class="stat-value" style="color:var(--purple)" id="stRate">‚Äî</div><div class="stat-label">Rate %</div></div>
    </div>

    <!-- Mode Tabs -->
    <div class="section">
        <div class="tabs">
            <button class="tab" data-mode="mega" onclick="switchMode('mega')">üî• Bulk</button>
            <button class="tab" data-mode="single" onclick="switchMode('single')">‚ö° Single</button>
            <button class="tab" data-mode="custom" onclick="switchMode('custom')">üõ†Ô∏è Custom</button>
            <button class="tab" data-mode="demo" onclick="switchMode('demo')">üéÆ Demo</button>
        </div>
    </div>

    <!-- MEGA BULK -->
    <div id="megaMode">
        <div class="card section" style="padding:16px">
            <div class="drop-zone" id="dropZone" style="margin-bottom:12px">
                <textarea id="megaInput" rows="5" class="input input-mono" style="border:none;background:transparent;border-radius:var(--radius)" placeholder="Paste API keys here ‚Äî one per line, comma-separated, or mixed text...

üîç AUTO: Detects sk-xxx, ghp_xxx, SG.xxx, gsk_xxx, AIza..., sk-ant-..., hf_xxx + 85 more
üìå MANUAL: Select provider below ‚Üí paste raw keys ‚Üí test all
üß™ DEEP: Custom prompt, model, max_tokens ‚Äî real JSON API calls
üìé Drag & drop .txt/.env/.csv files"></textarea>
            </div>

            <!-- Provider + Deep Test Row -->
            <div class="flex gap-2 flex-wrap items-end" style="margin-bottom:10px">
                <div style="flex:1;min-width:170px">
                    <div class="label">Provider Mode</div>
                    <select id="megaManualProv" class="input" style="padding:8px 10px;font-size:11px">
                        <option value="">üîç Auto-detect (pattern matching)</option>
                    </select>
                </div>
                <label class="toggle-row" id="deepToggle" style="flex:0 0 auto;margin-bottom:0">
                    <input type="checkbox" id="megaDeepTest" onchange="toggleDeepUI()">
                    <span>üß™ Deep Test</span>
                </label>
            </div>

            <!-- Deep Test Config (shown when deep test is on) -->
            <div id="deepConfig" class="hidden" style="margin-bottom:10px">
                <div class="deep-config">
                    <div>
                        <div class="label">Prompt Text</div>
                        <input type="text" id="deepPrompt" class="input" value="hi" placeholder="Custom prompt..." style="font-size:11px;padding:7px 9px">
                    </div>
                    <div>
                        <div class="label">Max Tokens</div>
                        <input type="number" id="deepMaxTokens" class="input" value="1" min="1" max="100" style="font-size:11px;padding:7px 9px;text-align:center">
                    </div>
                    <div>
                        <div class="label">Model Override</div>
                        <input type="text" id="deepModel" class="input" value="" placeholder="auto (default)" style="font-size:11px;padding:7px 9px">
                    </div>
                </div>
                <div style="margin-top:6px;padding:7px 10px;background:rgba(99,102,241,.03);border:1px solid rgba(99,102,241,.08);border-radius:7px;font-size:9px;color:var(--text2)">
                    <strong style="color:var(--accent2)">üß™ Deep Test</strong> sends real API requests with your custom prompt & token limit. Full JSON response captured. Works with AI providers. Minimal cost.
                </div>
            </div>

            <details style="margin-bottom:10px">
                <summary style="font-size:10px;font-weight:600;color:var(--text3);cursor:pointer;padding:5px 0;user-select:none">‚öôÔ∏è Advanced Settings</summary>
                <div class="settings-grid" style="margin-top:8px">
                    <div><div class="label">Concurrency</div><input type="range" id="megaConc" min="1" max="20" value="5" oninput="document.getElementById('concVal').textContent=this.value"><div style="font-size:9px;color:var(--text3);text-align:center;margin-top:1px"><span id="concVal">5</span> parallel</div></div>
                    <div><div class="label">Delay (ms)</div><input type="number" id="megaDelay" value="200" min="0" step="50" class="input" style="padding:7px;font-size:11px;text-align:center"></div>
                    <div><div class="label">Timeout (s)</div><input type="number" id="megaTimeout" value="15" min="3" max="60" class="input" style="padding:7px;font-size:11px;text-align:center"></div>
                    <div><div class="label">Retry</div><select id="megaRetry" class="input" style="padding:7px;font-size:11px"><option value="0">None</option><option value="1" selected>1x</option><option value="2">2x</option><option value="3">3x</option></select></div>
                </div>
                <div style="margin-top:8px;display:grid;grid-template-columns:1fr 1fr;gap:7px">
                    <div><div class="label">Response Limit</div><select id="megaRespLimit" class="input" style="padding:7px;font-size:11px"><option value="2000">2 KB</option><option value="5000">5 KB</option><option value="10000" selected>10 KB</option><option value="50000">50 KB</option><option value="0">Full (no limit)</option></select></div>
                    <div><div class="label">Delay Strategy</div><select id="megaDelayStrat" class="input" style="padding:7px;font-size:11px"><option value="fixed">Fixed</option><option value="random">Random (¬±50%)</option><option value="backoff">Exponential backoff</option></select></div>
                </div>
            </details>

            <div class="flex gap-2 flex-wrap">
                <button id="megaAnalyzeBtn" onclick="megaAnalyze()" class="btn btn-primary flex-1">üîç Analyze Keys</button>
                <button id="megaStartBtn" onclick="megaStart()" class="btn btn-success flex-1" disabled>‚ñ∂ Test All</button>
                <button id="megaPauseBtn" onclick="megaPause()" class="btn btn-secondary btn-sm hidden">‚è∏ Pause</button>
                <button id="megaResumeBtn" onclick="megaResume()" class="btn btn-secondary btn-sm hidden">‚ñ∂ Resume</button>
                <button id="megaCancelBtn" onclick="megaCancel()" class="btn btn-danger btn-sm hidden">‚èπ Stop</button>
                <button id="megaRetestBtn" onclick="megaRetest()" class="btn btn-secondary btn-sm hidden">üîÑ Re-test</button>
            </div>
        </div>

        <!-- Summary -->
        <div id="megaSummary" class="card section hidden" style="padding:14px">
            <div class="flex items-center justify-between mb-2">
                <span style="font-size:11px;font-weight:700">üìä Analysis</span>
                <div id="msBreakdown" class="flex gap-1 flex-wrap"></div>
            </div>
            <div style="display:grid;grid-template-columns:repeat(5,1fr);gap:5px">
                <div class="text-center"><div style="font-size:18px;font-weight:800;color:var(--accent)" id="msTotalKeys">0</div><div style="font-size:8px;color:var(--text3);font-weight:600">KEYS</div></div>
                <div class="text-center"><div style="font-size:18px;font-weight:800;color:var(--blue)" id="msProviders">0</div><div style="font-size:8px;color:var(--text3);font-weight:600">PROVIDERS</div></div>
                <div class="text-center"><div style="font-size:18px;font-weight:800;color:var(--yellow)" id="msDupes">0</div><div style="font-size:8px;color:var(--text3);font-weight:600">DUPES</div></div>
                <div class="text-center"><div style="font-size:18px;font-weight:800;color:var(--green)" id="msDetected">0</div><div style="font-size:8px;color:var(--text3);font-weight:600">DETECTED</div></div>
                <div class="text-center"><div style="font-size:18px;font-weight:800;color:var(--text3)" id="msUnknown">0</div><div style="font-size:8px;color:var(--text3);font-weight:600">UNKNOWN</div></div>
            </div>
        </div>

        <!-- Progress -->
        <div id="megaProgress" class="card section hidden" style="padding:14px">
            <div class="flex items-center justify-between mb-2">
                <div class="flex items-center gap-3">
                    <span style="font-size:12px;font-weight:700" id="mpText">0 / 0</span>
                    <span id="mpLive" class="hidden" style="font-size:9px;color:var(--green);font-weight:600"><span class="pulse">‚óè</span> LIVE</span>
                </div>
                <span style="font-size:10px;color:var(--text3)" id="mpEta">ETA: ‚Äî</span>
            </div>
            <div class="progress-bar"><div class="progress-fill" id="mpBar" style="width:0%"></div></div>
            <div class="progress-segments" id="mpStatsBar"></div>
            <div class="flex gap-3 mt-2 flex-wrap items-center justify-between">
                <div class="flex gap-2 flex-wrap">
                    <span style="font-size:10px;font-weight:600;color:var(--green)" id="mpValid">‚úÖ 0</span>
                    <span style="font-size:10px;font-weight:600;color:var(--red)" id="mpInvalid">‚ùå 0</span>
                    <span style="font-size:10px;font-weight:600;color:var(--yellow)" id="mpError">‚ö†Ô∏è 0</span>
                    <span style="font-size:10px;font-weight:600;color:var(--text3)" id="mpSkip">‚è≥ 0</span>
                </div>
                <div id="mpDonut" class="hidden">
                    <div class="donut" id="donutChart"><div class="donut-hole"><span class="donut-pct" id="donutPct">0%</span><span class="donut-label">valid</span></div></div>
                </div>
            </div>
        </div>

        <!-- Provider Stats -->
        <div id="megaProvStats" class="section hidden">
            <div class="flex items-center justify-between mb-2">
                <span style="font-size:10px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:.06em">Provider Breakdown</span>
                <button onclick="document.getElementById('provStatsGrid').classList.toggle('hidden')" class="btn btn-xs btn-ghost">Toggle</button>
            </div>
            <div class="prov-stats-grid" id="provStatsGrid"></div>
        </div>

        <!-- Filters -->
        <div id="megaFilters" class="section hidden">
            <div class="flex items-center justify-between flex-wrap gap-2 mb-2">
                <div class="flex gap-1 flex-wrap">
                    <button class="pill active" data-mf="all" onclick="megaFilter('all')">All <span class="pill-count" id="mfAll">0</span></button>
                    <button class="pill" data-mf="valid" onclick="megaFilter('valid')">‚úÖ <span class="pill-count" id="mfValid">0</span></button>
                    <button class="pill" data-mf="invalid" onclick="megaFilter('invalid')">‚ùå <span class="pill-count" id="mfInvalid">0</span></button>
                    <button class="pill" data-mf="error" onclick="megaFilter('error')">‚ö†Ô∏è <span class="pill-count" id="mfError">0</span></button>
                    <button class="pill" data-mf="pending" onclick="megaFilter('pending')">‚è≥ <span class="pill-count" id="mfPending">0</span></button>
                </div>
                <div class="flex gap-1 flex-wrap">
                    <button onclick="megaExportKeys('valid')" class="btn btn-xs btn-secondary" style="color:var(--green)">‚Üì Working</button>
                    <button onclick="megaExportKeys('all')" class="btn btn-xs btn-secondary">‚Üì CSV</button>
                    <button onclick="megaExportPostman()" class="btn btn-xs btn-secondary" style="color:var(--orange)">üìÆ Postman</button>
                    <button onclick="megaCopyWorking()" class="btn btn-xs btn-secondary" style="color:var(--accent2)">üìã Copy</button>
                </div>
            </div>
            <div class="mega-search">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
                <input type="text" id="megaSearchInp" placeholder="Search results..." class="input" oninput="megaRenderResults()">
            </div>
        </div>

        <!-- Results -->
        <div id="megaResults" class="card hidden" style="overflow:hidden">
            <div class="vscroll" id="megaResultsInner" style="padding:5px"></div>
        </div>
    </div>

    <!-- SINGLE TEST -->
    <div id="singleMode" class="hidden">
        <div class="card section" style="padding:16px">
            <div class="two-col" style="margin-bottom:10px">
                <div><div class="label">Provider</div><select id="apiProv" class="input" onchange="onProvChange()"><option value="">Select provider...</option></select></div>
                <div><div class="label">API Key</div>
                    <div style="position:relative">
                        <input type="password" id="apiKey" placeholder="Paste your key..." class="input input-mono" style="padding-right:55px">
                        <div style="position:absolute;right:3px;top:50%;transform:translateY(-50%);display:flex;gap:2px">
                            <button onclick="navigator.clipboard.readText().then(t=>{document.getElementById('apiKey').value=t;toast('üìã','Pasted')})" class="icon-btn" style="width:22px;height:22px;font-size:10px;border:none" title="Paste">üìã</button>
                            <button onclick="const i=document.getElementById('apiKey');i.type=i.type==='password'?'text':'password'" class="icon-btn" style="width:22px;height:22px;font-size:10px;border:none" title="Toggle">üëÅ</button>
                        </div>
                    </div>
                </div>
            </div>
            <div id="provInfo" class="hidden" style="margin-bottom:10px;padding:8px 12px;background:rgba(99,102,241,.03);border:1px solid rgba(99,102,241,.08);border-radius:8px;font-size:10px;color:var(--text2)"><span style="margin-right:4px">üí°</span><span id="provInfoT"></span></div>
            <div class="flex gap-2 flex-wrap">
                <button id="testBtn" onclick="testSingle(false)" class="btn btn-primary flex-1">‚ö° Quick Test</button>
                <button id="testDeepBtn" onclick="testSingle(true)" class="btn btn-success flex-1">üß™ Deep Test</button>
            </div>
            <div style="margin-top:6px;font-size:9px;color:var(--text3);text-align:center"><strong>Quick:</strong> Auth check ¬∑ <strong>Deep:</strong> Real JSON request with prompt</div>
        </div>
    </div>

    <!-- CUSTOM -->
    <div id="customMode" class="hidden">
        <div class="card section" style="padding:16px">
            <div style="display:grid;grid-template-columns:90px 1fr;gap:8px;margin-bottom:10px">
                <div><div class="label">Method</div><select id="cMethod" class="input"><option>GET</option><option>POST</option><option>PUT</option><option>DELETE</option><option>PATCH</option></select></div>
                <div><div class="label">URL</div><input type="text" id="cUrl" placeholder="https://api.example.com/v1/..." class="input input-mono"></div>
            </div>
            <div style="margin-bottom:10px">
                <div class="flex items-center justify-between mb-2"><div class="label" style="margin:0">Headers</div><button onclick="addCH()" class="btn btn-xs btn-ghost" style="color:var(--accent)">+ Add</button></div>
                <div id="cHeaders"><div class="header-row flex gap-2 mb-2"><input type="text" placeholder="Authorization" class="input input-mono chk" style="flex:1;padding:7px 9px;font-size:10px"><input type="text" placeholder="Bearer sk-..." class="input input-mono chv" style="flex:1;padding:7px 9px;font-size:10px"><button onclick="this.parentElement.remove()" style="color:var(--red);background:none;border:none;cursor:pointer;font-size:13px">‚úï</button></div></div>
            </div>
            <div style="margin-bottom:10px"><div class="label">Body</div><textarea id="cBody" rows="3" class="input input-mono" placeholder='{"key":"value"}'></textarea></div>
            <button onclick="runCustom()" class="btn btn-primary w-full" id="cBtn">üöÄ Send Request</button>
        </div>
    </div>

    <!-- DEMO -->
    <div id="demoMode" class="hidden">
        <div class="card section" style="padding:16px">
            <p style="font-size:11px;color:var(--text2);margin-bottom:12px">Try with free public APIs ‚Äî no key required:</p>
            <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(130px,1fr));gap:5px" id="demoGrid"></div>
        </div>
    </div>

    <!-- RESULT CARD -->
    <div id="resultCard" class="card result-card section hidden" style="padding:16px">
        <div class="flex items-center justify-between flex-wrap gap-2" style="margin-bottom:12px">
            <div class="flex items-center gap-2">
                <div id="rIco" style="width:34px;height:34px;border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:15px"></div>
                <div><div id="rTitle" style="font-size:13px;font-weight:700"></div><div id="rSub" style="font-size:10px;color:var(--text3)"></div></div>
            </div>
            <div class="flex gap-1 items-center">
                <span id="rSize" class="size-badge"></span>
                <span id="rLat" class="badge badge-blue"></span>
                <span id="rStat" class="badge"></span>
            </div>
        </div>
        <div class="progress-bar" style="height:2px;margin-bottom:12px"><div id="rBar" class="progress-fill" style="width:0%"></div></div>

        <div class="tabs" style="display:inline-flex;margin-bottom:12px">
            <button class="tab active" data-rt="resp" onclick="swRT('resp')">Response</button>
            <button class="tab" data-rt="hdrs" onclick="swRT('hdrs')">Headers</button>
            <button class="tab" data-rt="req" onclick="swRT('req')">Request</button>
            <button class="tab" data-rt="snip" onclick="swRT('snip')">Snippets</button>
            <button class="tab" data-rt="expl" onclick="swRT('expl')">Explain</button>
        </div>

        <div id="rt-resp">
            <div class="flex items-center justify-between mb-2"><div></div><div class="flex gap-1"><button onclick="toggleJV()" class="btn btn-xs btn-ghost" id="jvBtn">üå≥ Tree</button><button onclick="cpClip(lastRaw,'Copied!')" class="btn btn-xs btn-ghost">üìã Copy</button></div></div>
            <div id="rBody" class="res-body"></div>
        </div>
        <div id="rt-hdrs" class="hidden"><div id="rHdrs" class="res-body"></div></div>
        <div id="rt-req" class="hidden"><div id="rReq" class="res-body"></div></div>
        <div id="rt-snip" class="hidden">
            <div class="flex gap-1 mb-2 flex-wrap">
                <button class="btn btn-xs btn-ghost active" data-st="curl" onclick="swSnip('curl')" style="font-family:'JetBrains Mono',monospace">cURL</button>
                <button class="btn btn-xs btn-ghost" data-st="node" onclick="swSnip('node')" style="font-family:'JetBrains Mono',monospace">Node</button>
                <button class="btn btn-xs btn-ghost" data-st="python" onclick="swSnip('python')" style="font-family:'JetBrains Mono',monospace">Python</button>
                <button class="btn btn-xs btn-ghost" data-st="ci" onclick="swSnip('ci')" style="font-family:'JetBrains Mono',monospace">CI/CD</button>
            </div>
            <div style="position:relative"><div id="rSnip" class="res-body"></div><button onclick="cpClip(document.getElementById('rSnip').textContent,'Copied!')" class="btn btn-xs btn-ghost" style="position:absolute;top:5px;right:5px">üìã</button></div>
        </div>
        <div id="rt-expl" class="hidden"><div id="rExpl"></div></div>

        <div class="divider"></div>
        <div class="flex gap-1 flex-wrap">
            <button onclick="cpSlack()" class="btn btn-xs btn-secondary">üíº Slack</button>
            <button onclick="cpGH()" class="btn btn-xs btn-secondary">üêô GitHub</button>
            <button onclick="dlResult()" class="btn btn-xs btn-secondary">üíæ Export</button>
            <button onclick="exportPostmanSingle()" class="btn btn-xs btn-secondary" style="color:var(--orange)">üìÆ Postman</button>
        </div>
    </div>

    <!-- PROVIDERS -->
    <div class="section">
        <div style="position:relative;margin-bottom:10px">
            <svg style="width:12px;height:12px;position:absolute;left:10px;top:50%;transform:translateY(-50%);color:var(--text3)" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
            <input type="text" id="searchInp" placeholder="Search 85+ providers... (Ctrl+K)" class="input" style="padding-left:32px" oninput="renderGrid()">
        </div>
        <div class="flex gap-1 flex-wrap mb-3" id="catFilters"><button class="chip active" data-cat="all" onclick="filterCat('all')">All</button></div>
        <div class="svc-grid" id="svcGrid"></div>
        <div style="text-align:right;margin-top:5px"><span style="font-size:9px;color:var(--text3)" id="visCnt"></span></div>
    </div>

    <!-- Ad -->
    <div style="display:flex;justify-content:center;margin:20px 0">
        <script async="async" data-cfasync="false" src="https://pl28281782.effectivegatecpm.com/1ff05805f1f1e254ff63bae30ac5d8e3/invoke.js"></script>
        <div id="container-1ff05805f1f1e254ff63bae30ac5d8e3"></div>
    </div>

    <!-- Footer -->
    <footer style="text-align:center;padding:24px 0;border-top:1px solid var(--border)">
        <div class="flex items-center justify-center gap-2" style="margin-bottom:6px">
            <div class="logo-mark" style="width:20px;height:20px;font-size:8px;border-radius:5px">M</div>
            <span style="font-size:12px;font-weight:800">MDH TESTER</span>
            <span class="logo-badge">v5</span>
        </div>
        <p style="font-size:10px;color:var(--text3)">Built by <strong style="color:var(--accent2)">MDHojayfa</strong></p>
        <a href="https://t.me/MDHojayfa_bot" target="_blank" style="font-size:10px;color:var(--blue);text-decoration:none;display:inline-flex;align-items:center;gap:3px;margin-top:3px">‚úàÔ∏è @MDHojayfa_bot</a>
        <p style="font-size:8px;color:var(--text3);margin-top:6px">85+ providers ¬∑ 35+ patterns ¬∑ Deep test ¬∑ Full JSON ¬∑ Bulk 1000+</p>
    </footer>
</div>

<!-- SHARE MODAL -->
<div id="shareModal" class="modal-wrap" onclick="if(event.target===this)closeModal('shareModal')">
    <div class="modal">
        <div class="modal-header"><h3 style="font-size:14px;font-weight:700">üì§ Share MDH TESTER</h3><button onclick="closeModal('shareModal')" class="close-btn">‚úï</button></div>
        <div class="modal-body">
            <div class="flex gap-2 mb-3"><input type="text" value="https://mdhojayfa.github.io/mdhtester.html" readonly class="input input-mono flex-1" id="shareUrl"><button onclick="cpClip(document.getElementById('shareUrl').value,'Link copied!')" class="btn btn-primary btn-sm">Copy</button></div>
            <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:6px">
                <button onclick="shareVia('twitter')" class="btn btn-secondary" style="flex-direction:column;padding:12px;gap:3px"><span style="font-size:16px">ùïè</span><span style="font-size:9px">Twitter</span></button>
                <button onclick="shareVia('telegram')" class="btn btn-secondary" style="flex-direction:column;padding:12px;gap:3px"><span style="font-size:16px">‚úàÔ∏è</span><span style="font-size:9px">Telegram</span></button>
                <button onclick="shareVia('whatsapp')" class="btn btn-secondary" style="flex-direction:column;padding:12px;gap:3px"><span style="font-size:16px">üí¨</span><span style="font-size:9px">WhatsApp</span></button>
                <button onclick="shareVia('linkedin')" class="btn btn-secondary" style="flex-direction:column;padding:12px;gap:3px"><span style="font-size:16px">üíº</span><span style="font-size:9px">LinkedIn</span></button>
                <button onclick="shareVia('reddit')" class="btn btn-secondary" style="flex-direction:column;padding:12px;gap:3px"><span style="font-size:16px">ü§ñ</span><span style="font-size:9px">Reddit</span></button>
                <button onclick="shareVia('email')" class="btn btn-secondary" style="flex-direction:column;padding:12px;gap:3px"><span style="font-size:16px">üìß</span><span style="font-size:9px">Email</span></button>
            </div>
        </div>
    </div>
</div>

<!-- SCAN MODAL -->
<div id="scanModal" class="modal-wrap" onclick="if(event.target===this)closeModal('scanModal')">
    <div class="modal" style="max-width:540px">
        <div class="modal-header"><h3 style="font-size:14px;font-weight:700">üîç Key Leak Scanner</h3><button onclick="closeModal('scanModal')" class="close-btn">‚úï</button></div>
        <div class="modal-body">
            <p style="font-size:10px;color:var(--text3);margin-bottom:8px">Paste source code, logs, or text to scan for exposed API keys:</p>
            <textarea id="scanInp" rows="4" class="input input-mono mb-3" placeholder="Paste code, .env, or any text to scan..."></textarea>
            <button onclick="runScan()" class="btn btn-primary w-full mb-3">üîç Scan for Keys</button>
            <div id="scanRes"></div>
        </div>
    </div>
</div>

<!-- HISTORY PANEL -->
<div id="histOverlay" class="overlay" onclick="toggleHist()"></div>
<div id="histPanel" class="side-panel">
    <div style="padding:16px">
        <div class="flex items-center justify-between mb-3">
            <h3 style="font-size:14px;font-weight:700">üïê History</h3>
            <div class="flex gap-1">
                <button onclick="expHist()" class="btn btn-xs btn-secondary">‚Üì CSV</button>
                <button onclick="clearHist()" class="btn btn-xs btn-danger">Clear</button>
                <button onclick="toggleHist()" class="close-btn" style="width:26px;height:26px">‚úï</button>
            </div>
        </div>
        <div id="histList" style="display:flex;flex-direction:column;gap:5px"></div>
        <div id="histEmpty" class="text-center" style="padding:36px 0"><div style="font-size:28px;margin-bottom:6px">üïê</div><p style="font-size:11px;color:var(--text3)">No tests yet</p></div>
    </div>
</div>

<!-- TOAST -->
<div id="toastEl" class="toast"><div class="toast-inner"><span id="toastIco"></span><span id="toastMsg"></span></div></div>

<!-- Social Bar -->
<script type="text/javascript" src="https://pl28281605.effectivegatecpm.com/55/cd/5e/55cd5eea223aebc7290d280ad29905d5.js"></script>

<script>
const SITE_URL='https://mdhojayfa.github.io/mdhtester.html';
const ORIG_TITLE=document.title;

// ===== PROVIDERS =====
const P=[
{id:'openai',name:'OpenAI',icon:'ü§ñ',cat:'AI',info:'GPT/DALL-E keys (sk-...)',test:k=>fetch('https://api.openai.com/v1/models',{headers:{'Authorization':'Bearer '+k}})},
{id:'anthropic',name:'Anthropic',icon:'üß†',cat:'AI',info:'Claude keys (sk-ant-...)',test:k=>fetch('https://api.anthropic.com/v1/messages',{method:'POST',headers:{'x-api-key':k,'anthropic-version':'2023-06-01','Content-Type':'application/json'},body:JSON.stringify({model:'claude-3-haiku-20240307',max_tokens:1,messages:[{role:'user',content:'hi'}]})})},
{id:'gemini',name:'Google Gemini',icon:'üíé',cat:'AI',test:k=>fetch('https://generativelanguage.googleapis.com/v1beta/models?key='+k)},
{id:'groq',name:'Groq',icon:'‚ö°',cat:'AI',test:k=>fetch('https://api.groq.com/openai/v1/models',{headers:{'Authorization':'Bearer '+k}})},
{id:'mistral',name:'Mistral',icon:'üåä',cat:'AI',test:k=>fetch('https://api.mistral.ai/v1/models',{headers:{'Authorization':'Bearer '+k}})},
{id:'cohere',name:'Cohere',icon:'üîÆ',cat:'AI',test:k=>fetch('https://api.cohere.ai/v1/models',{headers:{'Authorization':'Bearer '+k}})},
{id:'huggingface',name:'HuggingFace',icon:'ü§ó',cat:'AI',test:k=>fetch('https://huggingface.co/api/whoami-v2',{headers:{'Authorization':'Bearer '+k}})},
{id:'replicate',name:'Replicate',icon:'üîÅ',cat:'AI',test:k=>fetch('https://api.replicate.com/v1/account',{headers:{'Authorization':'Token '+k}})},
{id:'stabilityai',name:'Stability AI',icon:'üé®',cat:'AI',test:k=>fetch('https://api.stability.ai/v1/user/account',{headers:{'Authorization':'Bearer '+k}})},
{id:'openrouter',name:'OpenRouter',icon:'üõ§Ô∏è',cat:'AI',test:k=>fetch('https://openrouter.ai/api/v1/models',{headers:{'Authorization':'Bearer '+k}})},
{id:'perplexity',name:'Perplexity',icon:'üîç',cat:'AI',test:k=>fetch('https://api.perplexity.ai/chat/completions',{method:'POST',headers:{'Authorization':'Bearer '+k,'Content-Type':'application/json'},body:JSON.stringify({model:'llama-3.1-sonar-small-128k-online',messages:[{role:'user',content:'hi'}],max_tokens:1})})},
{id:'together',name:'Together AI',icon:'ü§ù',cat:'AI',test:k=>fetch('https://api.together.xyz/v1/models',{headers:{'Authorization':'Bearer '+k}})},
{id:'elevenlabs',name:'ElevenLabs',icon:'üéôÔ∏è',cat:'AI',test:k=>fetch('https://api.elevenlabs.io/v1/user',{headers:{'xi-api-key':k}})},
{id:'deepl',name:'DeepL',icon:'üåç',cat:'AI',test:k=>fetch('https://api-free.deepl.com/v2/usage',{headers:{'Authorization':'DeepL-Auth-Key '+k}})},
{id:'deepseek',name:'DeepSeek',icon:'üî¨',cat:'AI',test:k=>fetch('https://api.deepseek.com/models',{headers:{'Authorization':'Bearer '+k}})},
{id:'fireworks',name:'Fireworks',icon:'üéÜ',cat:'AI',test:k=>fetch('https://api.fireworks.ai/inference/v1/models',{headers:{'Authorization':'Bearer '+k}})},
{id:'ai21',name:'AI21 Labs',icon:'üß™',cat:'AI',test:k=>fetch('https://api.ai21.com/studio/v1/models',{headers:{'Authorization':'Bearer '+k}})},
{id:'assemblyai',name:'AssemblyAI',icon:'üé§',cat:'AI',test:k=>fetch('https://api.assemblyai.com/v2/transcript?limit=1',{headers:{'Authorization':k}})},
{id:'voyageai',name:'Voyage AI',icon:'üö¢',cat:'AI',test:k=>fetch('https://api.voyageai.com/v1/models',{headers:{'Authorization':'Bearer '+k}})},
{id:'deepinfra',name:'DeepInfra',icon:'üß¨',cat:'AI',test:k=>fetch('https://api.deepinfra.com/v1/openai/models',{headers:{'Authorization':'Bearer '+k}})},
{id:'digitalocean',name:'DigitalOcean',icon:'üê≥',cat:'Cloud',test:k=>fetch('https://api.digitalocean.com/v2/account',{headers:{'Authorization':'Bearer '+k}})},
{id:'cloudflare',name:'Cloudflare',icon:'‚òÅÔ∏è',cat:'Cloud',test:k=>fetch('https://api.cloudflare.com/client/v4/user/tokens/verify',{headers:{'Authorization':'Bearer '+k}})},
{id:'vercel',name:'Vercel',icon:'‚ñ≤',cat:'Cloud',test:k=>fetch('https://api.vercel.com/v2/user',{headers:{'Authorization':'Bearer '+k}})},
{id:'netlify',name:'Netlify',icon:'üåê',cat:'Cloud',test:k=>fetch('https://api.netlify.com/api/v1/user',{headers:{'Authorization':'Bearer '+k}})},
{id:'render',name:'Render',icon:'üéØ',cat:'Cloud',test:k=>fetch('https://api.render.com/v1/owners',{headers:{'Authorization':'Bearer '+k}})},
{id:'heroku',name:'Heroku',icon:'üü™',cat:'Cloud',test:k=>fetch('https://api.heroku.com/account',{headers:{'Authorization':'Bearer '+k,'Accept':'application/vnd.heroku+json; version=3'}})},
{id:'linode',name:'Linode',icon:'üü¢',cat:'Cloud',test:k=>fetch('https://api.linode.com/v4/profile',{headers:{'Authorization':'Bearer '+k}})},
{id:'vultr',name:'Vultr',icon:'üîµ',cat:'Cloud',test:k=>fetch('https://api.vultr.com/v2/account',{headers:{'Authorization':'Bearer '+k}})},
{id:'hetzner',name:'Hetzner',icon:'üèóÔ∏è',cat:'Cloud',test:k=>fetch('https://api.hetzner.cloud/v1/servers?per_page=1',{headers:{'Authorization':'Bearer '+k}})},
{id:'railway',name:'Railway',icon:'üöÇ',cat:'Cloud',test:k=>fetch('https://backboard.railway.app/graphql/v2',{method:'POST',headers:{'Authorization':'Bearer '+k,'Content-Type':'application/json'},body:JSON.stringify({query:'{ me { id } }'})})},
{id:'fly',name:'Fly.io',icon:'ü™Å',cat:'Cloud',test:k=>fetch('https://api.fly.io/graphql',{method:'POST',headers:{'Authorization':'Bearer '+k,'Content-Type':'application/json'},body:JSON.stringify({query:'{ viewer { email } }'})})},
{id:'github',name:'GitHub',icon:'üêô',cat:'DevOps',test:k=>fetch('https://api.github.com/user',{headers:{'Authorization':'Bearer '+k}})},
{id:'gitlab',name:'GitLab',icon:'ü¶ä',cat:'DevOps',test:k=>fetch('https://gitlab.com/api/v4/user',{headers:{'PRIVATE-TOKEN':k}})},
{id:'npm',name:'NPM',icon:'üì¶',cat:'DevOps',test:k=>fetch('https://registry.npmjs.org/-/npm/v1/user',{headers:{'Authorization':'Bearer '+k}})},
{id:'circleci',name:'CircleCI',icon:'‚≠ï',cat:'DevOps',test:k=>fetch('https://circleci.com/api/v2/me',{headers:{'Circle-Token':k}})},
{id:'sentry',name:'Sentry',icon:'üêõ',cat:'DevOps',test:k=>fetch('https://sentry.io/api/0/auth/',{headers:{'Authorization':'Bearer '+k}})},
{id:'bitbucket',name:'Bitbucket',icon:'ü™£',cat:'DevOps',test:k=>fetch('https://api.bitbucket.org/2.0/user',{headers:{'Authorization':'Bearer '+k}})},
{id:'telegram',name:'Telegram Bot',icon:'üì±',cat:'Messaging',test:k=>fetch('https://api.telegram.org/bot'+k+'/getMe')},
{id:'discord',name:'Discord Bot',icon:'üí¨',cat:'Messaging',test:k=>fetch('https://discord.com/api/v10/users/@me',{headers:{'Authorization':'Bot '+k}})},
{id:'slack',name:'Slack',icon:'üíº',cat:'Messaging',test:k=>fetch('https://slack.com/api/auth.test?token='+k)},
{id:'sendgrid',name:'SendGrid',icon:'üìß',cat:'Messaging',test:k=>fetch('https://api.sendgrid.com/v3/user/profile',{headers:{'Authorization':'Bearer '+k}})},
{id:'mailgun',name:'Mailgun',icon:'‚úâÔ∏è',cat:'Messaging',test:k=>fetch('https://api.mailgun.net/v3/domains',{headers:{'Authorization':'Basic '+btoa('api:'+k)}})},
{id:'resend',name:'Resend',icon:'üì§',cat:'Messaging',test:k=>fetch('https://api.resend.com/domains',{headers:{'Authorization':'Bearer '+k}})},
{id:'postmark',name:'Postmark',icon:'üì¨',cat:'Messaging',test:k=>fetch('https://api.postmarkapp.com/server',{headers:{'X-Postmark-Server-Token':k,'Accept':'application/json'}})},
{id:'twilio',name:'Twilio',icon:'üìû',cat:'Messaging',test:k=>fetch('https://api.twilio.com/2010-04-01/Accounts.json',{headers:{'Authorization':'Basic '+btoa(k)}})},
{id:'brevo',name:'Brevo',icon:'üì®',cat:'Messaging',test:k=>fetch('https://api.brevo.com/v3/account',{headers:{'api-key':k}})},
{id:'stripe',name:'Stripe',icon:'üí≥',cat:'Payment',test:k=>fetch('https://api.stripe.com/v1/balance',{headers:{'Authorization':'Bearer '+k}})},
{id:'coinbase',name:'Coinbase',icon:'ü™ô',cat:'Payment',test:k=>fetch('https://api.coinbase.com/v2/user',{headers:{'Authorization':'Bearer '+k}})},
{id:'lemonsqueezy',name:'LemonSqueezy',icon:'üçã',cat:'Payment',test:k=>fetch('https://api.lemonsqueezy.com/v1/users/me',{headers:{'Authorization':'Bearer '+k,'Accept':'application/vnd.api+json'}})},
{id:'paddle',name:'Paddle',icon:'üèì',cat:'Payment',test:k=>fetch('https://api.paddle.com/event-types',{headers:{'Authorization':'Bearer '+k}})},
{id:'paypal',name:'PayPal',icon:'üí∞',cat:'Payment',test:k=>fetch('https://api-m.paypal.com/v1/oauth2/token',{method:'POST',headers:{'Authorization':'Basic '+btoa(k),'Content-Type':'application/x-www-form-urlencoded'},body:'grant_type=client_credentials'})},
{id:'googlemaps',name:'Google Maps',icon:'üó∫Ô∏è',cat:'Data',test:k=>fetch('https://maps.googleapis.com/maps/api/geocode/json?address=test&key='+k)},
{id:'openweather',name:'OpenWeather',icon:'üå§Ô∏è',cat:'Data',test:k=>fetch('https://api.openweathermap.org/data/2.5/weather?q=London&appid='+k)},
{id:'newsapi',name:'NewsAPI',icon:'üì∞',cat:'Data',test:k=>fetch('https://newsapi.org/v2/top-headlines?country=us&pageSize=1&apiKey='+k)},
{id:'ipinfo',name:'IPinfo',icon:'üåç',cat:'Data',test:k=>fetch('https://ipinfo.io/json?token='+k)},
{id:'mapbox',name:'Mapbox',icon:'üìç',cat:'Data',test:k=>fetch('https://api.mapbox.com/tokens/v2?access_token='+k)},
{id:'exchangerate',name:'ExchangeRate',icon:'üí±',cat:'Data',test:k=>fetch('https://v6.exchangerate-api.com/v6/'+k+'/latest/USD')},
{id:'virustotal',name:'VirusTotal',icon:'üõ°Ô∏è',cat:'Security',test:k=>fetch('https://www.virustotal.com/api/v3/users/me',{headers:{'x-apikey':k}})},
{id:'shodan',name:'Shodan',icon:'üîé',cat:'Security',test:k=>fetch('https://api.shodan.io/api-info?key='+k)},
{id:'hunter',name:'Hunter.io',icon:'üéØ',cat:'Security',test:k=>fetch('https://api.hunter.io/v2/account?api_key='+k)},
{id:'abuseipdb',name:'AbuseIPDB',icon:'üö´',cat:'Security',test:k=>fetch('https://api.abuseipdb.com/api/v2/check?ipAddress=8.8.8.8',{headers:{'Key':k,'Accept':'application/json'}})},
{id:'securitytrails',name:'SecurityTrails',icon:'üîê',cat:'Security',test:k=>fetch('https://api.securitytrails.com/v1/ping',{headers:{'APIKEY':k}})},
{id:'notion',name:'Notion',icon:'üìù',cat:'Productivity',test:k=>fetch('https://api.notion.com/v1/users/me',{headers:{'Authorization':'Bearer '+k,'Notion-Version':'2022-06-28'}})},
{id:'airtable',name:'Airtable',icon:'üìä',cat:'Productivity',test:k=>fetch('https://api.airtable.com/v0/meta/whoami',{headers:{'Authorization':'Bearer '+k}})},
{id:'linear',name:'Linear',icon:'üìê',cat:'Productivity',test:k=>fetch('https://api.linear.app/graphql',{method:'POST',headers:{'Authorization':k,'Content-Type':'application/json'},body:JSON.stringify({query:'{ viewer { id } }'})})},
{id:'clickup',name:'ClickUp',icon:'‚úÖ',cat:'Productivity',test:k=>fetch('https://api.clickup.com/api/v2/user',{headers:{'Authorization':k}})},
{id:'todoist',name:'Todoist',icon:'‚òëÔ∏è',cat:'Productivity',test:k=>fetch('https://api.todoist.com/rest/v2/projects',{headers:{'Authorization':'Bearer '+k}})},
{id:'asana',name:'Asana',icon:'üìã',cat:'Productivity',test:k=>fetch('https://app.asana.com/api/1.0/users/me',{headers:{'Authorization':'Bearer '+k}})},
{id:'monday',name:'Monday.com',icon:'üìÖ',cat:'Productivity',test:k=>fetch('https://api.monday.com/v2',{method:'POST',headers:{'Authorization':k,'Content-Type':'application/json'},body:JSON.stringify({query:'{ me { id } }'})})},
{id:'giphy',name:'Giphy',icon:'üéûÔ∏è',cat:'Media',test:k=>fetch('https://api.giphy.com/v1/gifs/trending?api_key='+k+'&limit=1')},
{id:'tmdb',name:'TMDB',icon:'üé¨',cat:'Media',test:k=>fetch('https://api.themoviedb.org/3/movie/popular?api_key='+k)},
{id:'unsplash',name:'Unsplash',icon:'üì∑',cat:'Media',test:k=>fetch('https://api.unsplash.com/me',{headers:{'Authorization':'Client-ID '+k}})},
{id:'pexels',name:'Pexels',icon:'üì∏',cat:'Media',test:k=>fetch('https://api.pexels.com/v1/curated?per_page=1',{headers:{'Authorization':k}})},
{id:'imgur',name:'Imgur',icon:'üñºÔ∏è',cat:'Media',test:k=>fetch('https://api.imgur.com/3/credits',{headers:{'Authorization':'Client-ID '+k}})},
{id:'youtube',name:'YouTube Data',icon:'üì∫',cat:'Media',test:k=>fetch('https://www.googleapis.com/youtube/v3/channels?part=id&mine=true&key='+k)},
{id:'firebase',name:'Firebase',icon:'üî•',cat:'Database',test:k=>fetch('https://identitytoolkit.googleapis.com/v1/accounts:signUp?key='+k,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({})})},
{id:'neon',name:'Neon',icon:'üü¢',cat:'Database',test:k=>fetch('https://console.neon.tech/api/v2/projects',{headers:{'Authorization':'Bearer '+k}})},
{id:'turso',name:'Turso',icon:'üî∑',cat:'Database',test:k=>fetch('https://api.turso.tech/v1/organizations',{headers:{'Authorization':'Bearer '+k}})},
{id:'supabase',name:'Supabase',icon:'‚ö°',cat:'Database',test:k=>fetch('https://api.supabase.com/v1/projects',{headers:{'Authorization':'Bearer '+k}})},
{id:'upstash',name:'Upstash',icon:'üî∫',cat:'Database',test:k=>fetch('https://api.upstash.com/v2/redis/databases',{headers:{'Authorization':'Bearer '+k}})},
{id:'mongodb',name:'MongoDB Atlas',icon:'üçÉ',cat:'Database',test:k=>fetch('https://cloud.mongodb.com/api/atlas/v2/groups',{headers:{'Authorization':'Bearer '+k}})},
{id:'pinecone',name:'Pinecone',icon:'üå≤',cat:'Database',test:k=>fetch('https://api.pinecone.io/indexes',{headers:{'Api-Key':k}})},
{id:'posthog',name:'PostHog',icon:'ü¶î',cat:'Analytics',test:k=>fetch('https://app.posthog.com/api/users/@me/',{headers:{'Authorization':'Bearer '+k}})},
{id:'datadog',name:'Datadog',icon:'üêï',cat:'Analytics',test:k=>fetch('https://api.datadoghq.com/api/v1/validate',{headers:{'DD-API-KEY':k}})},
{id:'mixpanel',name:'Mixpanel',icon:'üìà',cat:'Analytics',test:k=>fetch('https://mixpanel.com/api/app/me',{headers:{'Authorization':'Bearer '+k}})},
{id:'rapidapi',name:'RapidAPI',icon:'üöÄ',cat:'Other',test:k=>fetch('https://judge0-ce.p.rapidapi.com/about',{headers:{'X-RapidAPI-Key':k}})},
{id:'figma',name:'Figma',icon:'üé®',cat:'Other',test:k=>fetch('https://api.figma.com/v1/me',{headers:{'X-FIGMA-TOKEN':k}})},
{id:'webflow',name:'Webflow',icon:'üåä',cat:'Other',test:k=>fetch('https://api.webflow.com/v2/token/introspect',{headers:{'Authorization':'Bearer '+k}})},
{id:'calendly',name:'Calendly',icon:'üìÖ',cat:'Other',test:k=>fetch('https://api.calendly.com/users/me',{headers:{'Authorization':'Bearer '+k}})},
{id:'algolia',name:'Algolia',icon:'üîç',cat:'Other',test:k=>fetch('https://latency-dsn.algolia.net/1/keys/'+k,{headers:{'X-Algolia-Application-Id':'latency'}})},
{id:'contentful',name:'Contentful',icon:'üìÑ',cat:'Other',test:k=>fetch('https://cdn.contentful.com/spaces/cfexampleapi/entries?access_token='+k)},
{id:'liveblocks',name:'Liveblocks',icon:'üß±',cat:'Other',test:k=>fetch('https://api.liveblocks.io/v2/rooms',{headers:{'Authorization':'Bearer '+k}})},
];

const KEY_PAT=[
{name:'OpenAI',prov:'openai',rx:/\bsk-[A-Za-z0-9]{20,}\b/g},
{name:'OpenAI (proj)',prov:'openai',rx:/\bsk-proj-[A-Za-z0-9_-]{40,}\b/g},
{name:'OpenAI (svc)',prov:'openai',rx:/\bsk-svcacct-[A-Za-z0-9_-]{40,}\b/g},
{name:'Anthropic',prov:'anthropic',rx:/\bsk-ant-[A-Za-z0-9_-]{40,}\b/g},
{name:'Groq',prov:'groq',rx:/\bgsk_[A-Za-z0-9]{50,}\b/g},
{name:'GitHub',prov:'github',rx:/\bgh[pousr]_[A-Za-z0-9]{36}\b/g},
{name:'GitLab',prov:'gitlab',rx:/\bglpat-[A-Za-z0-9_-]{20,}\b/g},
{name:'Stripe Live',prov:'stripe',rx:/\bsk_live_[A-Za-z0-9]{24,}\b/g},
{name:'Stripe Test',prov:'stripe',rx:/\bsk_test_[A-Za-z0-9]{24,}\b/g},
{name:'SendGrid',prov:'sendgrid',rx:/\bSG\.[A-Za-z0-9_-]{22}\.[A-Za-z0-9_-]{43}\b/g},
{name:'Slack',prov:'slack',rx:/\bxox[bp]-[0-9]{10,}-[A-Za-z0-9-]+\b/g},
{name:'Telegram',prov:'telegram',rx:/\b[0-9]{8,10}:[A-Za-z0-9_-]{35}\b/g},
{name:'Discord',prov:'discord',rx:/\b[MN][A-Za-z0-9]{23,}\.[A-Za-z0-9_-]{6}\.[A-Za-z0-9_-]{27,}\b/g},
{name:'HuggingFace',prov:'huggingface',rx:/\bhf_[A-Za-z0-9]{34}\b/g},
{name:'Replicate',prov:'replicate',rx:/\br8_[A-Za-z0-9]{36,}\b/g},
{name:'AWS',prov:null,rx:/\bAKIA[0-9A-Z]{16}\b/g},
{name:'Google/Gemini',prov:'gemini',rx:/\bAIza[0-9A-Za-z_-]{35}\b/g},
{name:'NPM',prov:'npm',rx:/\bnpm_[A-Za-z0-9]{36}\b/g},
{name:'Resend',prov:'resend',rx:/\bre_[A-Za-z0-9_]{20,}\b/g},
{name:'Notion',prov:'notion',rx:/\bntn_[A-Za-z0-9]{40,}\b/g},
{name:'Linear',prov:'linear',rx:/\blin_api_[A-Za-z0-9]{40,}\b/g},
{name:'Mailgun',prov:'mailgun',rx:/\bkey-[a-f0-9]{32}\b/g},
{name:'Vercel',prov:'vercel',rx:/\bvercel_[A-Za-z0-9_]{20,}\b/g},
{name:'Supabase',prov:'supabase',rx:/\bsbp_[A-Za-z0-9]{36,}\b/g},
{name:'Pinecone',prov:'pinecone',rx:/\bpcsk_[A-Za-z0-9_]{40,}\b/g},
{name:'Figma',prov:'figma',rx:/\bfigd_[A-Za-z0-9_-]{40,}\b/g},
{name:'Brevo',prov:'brevo',rx:/\bxkeysib-[A-Za-z0-9]{64,}\b/g},
{name:'Twilio',prov:'twilio',rx:/\bSK[0-9a-f]{32}\b/g},
{name:'DeepSeek',prov:'deepseek',rx:/\bsk-[a-f0-9]{48}\b/g},
];

const DEMOS=[
{name:'JSONPlaceholder',icon:'üìã',url:'https://jsonplaceholder.typicode.com/posts/1'},
{name:'PokeAPI',icon:'‚ö°',url:'https://pokeapi.co/api/v2/pokemon/pikachu'},
{name:'Cat Facts',icon:'üê±',url:'https://catfact.ninja/fact'},
{name:'Dog API',icon:'üêï',url:'https://dog.ceo/api/breeds/image/random'},
{name:'IP Info',icon:'üåê',url:'https://ipapi.co/json/'},
{name:'Jokes',icon:'üòÇ',url:'https://v2.jokeapi.dev/joke/Programming?type=single'},
{name:'Random User',icon:'üë§',url:'https://randomuser.me/api/?results=1'},
{name:'Bored API',icon:'üé≤',url:'https://bored-api.appbrewery.com/random'},
{name:'Open Library',icon:'üìö',url:'https://openlibrary.org/api/books?bibkeys=ISBN:0451526538&format=json'},
];

const ERR_EX={200:{t:'‚úÖ Valid & Working',s:'green',d:'Key authenticated. Full access.'},201:{t:'‚úÖ Created',s:'green',d:'Key has write access.'},204:{t:'‚úÖ No Content',s:'green',d:'Success, no body.'},400:{t:'‚ö†Ô∏è Bad Request',s:'yellow',d:'Format issue ‚Äî key may still be valid.'},401:{t:'‚ùå Unauthorized',s:'red',d:'Key invalid, expired, or revoked.'},403:{t:'üö´ Forbidden',s:'red',d:'Key recognized but lacks permissions.'},404:{t:'‚ùì Not Found',s:'yellow',d:'Endpoint not found.'},429:{t:'‚è±Ô∏è Rate Limited',s:'yellow',d:'Key likely VALID but rate-limited.'},500:{t:'üí• Server Error',s:'red',d:'Provider issue, not key-related.'},502:{t:'üí• Bad Gateway',s:'red',d:'Try again later.'},503:{t:'üí• Unavailable',s:'red',d:'Provider down.'}};

// ===== STATE =====
let hist=JSON.parse(localStorage.getItem('mdhH')||'[]');
let stats=JSON.parse(localStorage.getItem('mdhS')||'{"t":0,"v":0,"i":0,"l":[]}');
let curCat='all',curMode='mega';
let lastRaw='',lastHdrs='',lastReqI='',lastStat=0,jvMode='raw',curSnip='curl';
let isDark=localStorage.getItem('mdhT')!=='light';
let soundOn=localStorage.getItem('mdhSnd')!=='off';
let megaKeys=[],megaRunning=false,megaPaused=false,megaCancelled=false;
let megaDone=0,megaValid=0,megaInvalid=0,megaError=0;
let megaStartTime=0,megaFilterMode='all',megaSortCol='',megaSortDir=1;
let expandedRow=-1;

// ===== DEEP TEST CONFIG =====
function getDeepCfg(){return{prompt:document.getElementById('deepPrompt')?.value||'hi',maxTokens:parseInt(document.getElementById('deepMaxTokens')?.value)||1,model:document.getElementById('deepModel')?.value?.trim()||''};}
function toggleDeepUI(){const on=document.getElementById('megaDeepTest').checked;document.getElementById('deepConfig').classList.toggle('hidden',!on);document.getElementById('deepToggle').classList.toggle('on',on);}

function buildDeepFn(provId,cfg){
const p=cfg.prompt,mt=cfg.maxTokens,mo=cfg.model;
const M={
'openai':()=>fetch('https://api.openai.com/v1/chat/completions',{method:'POST',headers:{'Authorization':'Bearer '+'{KEY}','Content-Type':'application/json'},body:JSON.stringify({model:mo||'gpt-3.5-turbo',messages:[{role:'user',content:p}],max_tokens:mt})}),
'groq':()=>fetch('https://api.groq.com/openai/v1/chat/completions',{method:'POST',headers:{'Authorization':'Bearer '+'{KEY}','Content-Type':'application/json'},body:JSON.stringify({model:mo||'llama3-8b-8192',messages:[{role:'user',content:p}],max_tokens:mt})}),
'mistral':()=>fetch('https://api.mistral.ai/v1/chat/completions',{method:'POST',headers:{'Authorization':'Bearer '+'{KEY}','Content-Type':'application/json'},body:JSON.stringify({model:mo||'open-mistral-7b',messages:[{role:'user',content:p}],max_tokens:mt})}),
'together':()=>fetch('https://api.together.xyz/v1/chat/completions',{method:'POST',headers:{'Authorization':'Bearer '+'{KEY}','Content-Type':'application/json'},body:JSON.stringify({model:mo||'meta-llama/Llama-3-8b-chat-hf',messages:[{role:'user',content:p}],max_tokens:mt})}),
'deepseek':()=>fetch('https://api.deepseek.com/chat/completions',{method:'POST',headers:{'Authorization':'Bearer '+'{KEY}','Content-Type':'application/json'},body:JSON.stringify({model:mo||'deepseek-chat',messages:[{role:'user',content:p}],max_tokens:mt})}),
'fireworks':()=>fetch('https://api.fireworks.ai/inference/v1/chat/completions',{method:'POST',headers:{'Authorization':'Bearer '+'{KEY}','Content-Type':'application/json'},body:JSON.stringify({model:mo||'accounts/fireworks/models/llama-v3p1-8b-instruct',messages:[{role:'user',content:p}],max_tokens:mt})}),
'openrouter':()=>fetch('https://openrouter.ai/api/v1/chat/completions',{method:'POST',headers:{'Authorization':'Bearer '+'{KEY}','Content-Type':'application/json'},body:JSON.stringify({model:mo||'meta-llama/llama-3-8b-instruct',messages:[{role:'user',content:p}],max_tokens:mt})}),
'deepinfra':()=>fetch('https://api.deepinfra.com/v1/openai/chat/completions',{method:'POST',headers:{'Authorization':'Bearer '+'{KEY}','Content-Type':'application/json'},body:JSON.stringify({model:mo||'meta-llama/Meta-Llama-3-8B-Instruct',messages:[{role:'user',content:p}],max_tokens:mt})}),
'cohere':()=>fetch('https://api.cohere.ai/v1/chat',{method:'POST',headers:{'Authorization':'Bearer '+'{KEY}','Content-Type':'application/json'},body:JSON.stringify({message:p,max_tokens:mt})}),
'gemini':()=>fetch('https://generativelanguage.googleapis.com/v1beta/models/'+(mo||'gemini-pro')+':generateContent?key={KEY}',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({contents:[{parts:[{text:p}]}],generationConfig:{maxOutputTokens:mt}})}),
'perplexity':()=>fetch('https://api.perplexity.ai/chat/completions',{method:'POST',headers:{'Authorization':'Bearer '+'{KEY}','Content-Type':'application/json'},body:JSON.stringify({model:mo||'llama-3.1-sonar-small-128k-online',messages:[{role:'user',content:p}],max_tokens:mt})}),
'anthropic':()=>fetch('https://api.anthropic.com/v1/messages',{method:'POST',headers:{'x-api-key':'{KEY}','anthropic-version':'2023-06-01','Content-Type':'application/json'},body:JSON.stringify({model:mo||'claude-3-haiku-20240307',max_tokens:mt,messages:[{role:'user',content:p}]})}),
'huggingface':()=>fetch('https://api-inference.huggingface.co/models/'+(mo||'gpt2'),{method:'POST',headers:{'Authorization':'Bearer '+'{KEY}','Content-Type':'application/json'},body:JSON.stringify({inputs:p,parameters:{max_new_tokens:mt}})}),
'ai21':()=>fetch('https://api.ai21.com/studio/v1/j2-light/complete',{method:'POST',headers:{'Authorization':'Bearer '+'{KEY}','Content-Type':'application/json'},body:JSON.stringify({prompt:p,maxTokens:mt})}),
'deepl':()=>fetch('https://api-free.deepl.com/v2/translate',{method:'POST',headers:{'Authorization':'DeepL-Auth-Key '+'{KEY}','Content-Type':'application/json'},body:JSON.stringify({text:[p],target_lang:'DE'})}),
};
if(!M[provId])return null;
// Return a function that takes key and swaps {KEY}
return k=>{const origFn=M[provId];const origFetch=window.fetch;window._deepKey=k;
// We need to build the fetch call with the key injected
return buildDeepFetch(provId,k,cfg);};
}

function buildDeepFetch(provId,k,cfg){
const p=cfg.prompt,mt=cfg.maxTokens,mo=cfg.model;
const hdr=(auth)=>({'Authorization':auth,'Content-Type':'application/json'});
switch(provId){
case'openai':return fetch('https://api.openai.com/v1/chat/completions',{method:'POST',headers:hdr('Bearer '+k),body:JSON.stringify({model:mo||'gpt-3.5-turbo',messages:[{role:'user',content:p}],max_tokens:mt})});
case'groq':return fetch('https://api.groq.com/openai/v1/chat/completions',{method:'POST',headers:hdr('Bearer '+k),body:JSON.stringify({model:mo||'llama3-8b-8192',messages:[{role:'user',content:p}],max_tokens:mt})});
case'mistral':return fetch('https://api.mistral.ai/v1/chat/completions',{method:'POST',headers:hdr('Bearer '+k),body:JSON.stringify({model:mo||'open-mistral-7b',messages:[{role:'user',content:p}],max_tokens:mt})});
case'together':return fetch('https://api.together.xyz/v1/chat/completions',{method:'POST',headers:hdr('Bearer '+k),body:JSON.stringify({model:mo||'meta-llama/Llama-3-8b-chat-hf',messages:[{role:'user',content:p}],max_tokens:mt})});
case'deepseek':return fetch('https://api.deepseek.com/chat/completions',{method:'POST',headers:hdr('Bearer '+k),body:JSON.stringify({model:mo||'deepseek-chat',messages:[{role:'user',content:p}],max_tokens:mt})});
case'fireworks':return fetch('https://api.fireworks.ai/inference/v1/chat/completions',{method:'POST',headers:hdr('Bearer '+k),body:JSON.stringify({model:mo||'accounts/fireworks/models/llama-v3p1-8b-instruct',messages:[{role:'user',content:p}],max_tokens:mt})});
case'openrouter':return fetch('https://openrouter.ai/api/v1/chat/completions',{method:'POST',headers:hdr('Bearer '+k),body:JSON.stringify({model:mo||'meta-llama/llama-3-8b-instruct',messages:[{role:'user',content:p}],max_tokens:mt})});
case'deepinfra':return fetch('https://api.deepinfra.com/v1/openai/chat/completions',{method:'POST',headers:hdr('Bearer '+k),body:JSON.stringify({model:mo||'meta-llama/Meta-Llama-3-8B-Instruct',messages:[{role:'user',content:p}],max_tokens:mt})});
case'cohere':return fetch('https://api.cohere.ai/v1/chat',{method:'POST',headers:hdr('Bearer '+k),body:JSON.stringify({message:p,max_tokens:mt})});
case'gemini':return fetch('https://generativelanguage.googleapis.com/v1beta/models/'+(mo||'gemini-pro')+':generateContent?key='+k,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({contents:[{parts:[{text:p}]}],generationConfig:{maxOutputTokens:mt}})});
case'perplexity':return fetch('https://api.perplexity.ai/chat/completions',{method:'POST',headers:hdr('Bearer '+k),body:JSON.stringify({model:mo||'llama-3.1-sonar-small-128k-online',messages:[{role:'user',content:p}],max_tokens:mt})});
case'anthropic':return fetch('https://api.anthropic.com/v1/messages',{method:'POST',headers:{'x-api-key':k,'anthropic-version':'2023-06-01','Content-Type':'application/json'},body:JSON.stringify({model:mo||'claude-3-haiku-20240307',max_tokens:mt,messages:[{role:'user',content:p}]})});
case'huggingface':return fetch('https://api-inference.huggingface.co/models/'+(mo||'gpt2'),{method:'POST',headers:hdr('Bearer '+k),body:JSON.stringify({inputs:p,parameters:{max_new_tokens:mt}})});
case'ai21':return fetch('https://api.ai21.com/studio/v1/j2-light/complete',{method:'POST',headers:hdr('Bearer '+k),body:JSON.stringify({prompt:p,maxTokens:mt})});
case'deepl':return fetch('https://api-free.deepl.com/v2/translate',{method:'POST',headers:{'Authorization':'DeepL-Auth-Key '+k,'Content-Type':'application/json'},body:JSON.stringify({text:[p],target_lang:'DE'})});
case'elevenlabs':return fetch('https://api.elevenlabs.io/v1/text-to-speech/21m00Tcm4TlvDq8ikWAM',{method:'POST',headers:{'xi-api-key':k,'Content-Type':'application/json'},body:JSON.stringify({text:p,model_id:'eleven_monolingual_v1'})});
default:return null;
}
}

// ===== INIT =====
function init(){
    if(!isDark){document.documentElement.setAttribute('data-theme','light');document.getElementById('themeIco').textContent='‚òÄÔ∏è';}
    if(!soundOn)document.getElementById('soundBtn').classList.add('muted');
    if(sessionStorage.getItem('mdhC')==='y')document.getElementById('consent').style.display='none';
    buildCats();buildProvSel();buildMegaProvSel();renderGrid();buildDemos();updStats();renderHist();setupDrop();
    switchMode('mega');
    document.addEventListener('keydown',e=>{
        if((e.ctrlKey||e.metaKey)&&e.key==='k'){e.preventDefault();document.getElementById('searchInp').focus();}
        if((e.ctrlKey||e.metaKey)&&e.key==='Enter'){e.preventDefault();if(curMode==='single')testSingle();else if(curMode==='custom')runCustom();}
        if(e.key==='Escape'){closeModal('shareModal');closeModal('scanModal');if(document.getElementById('histPanel').classList.contains('open'))toggleHist();}
    });
}

function acceptConsent(){if(!document.getElementById('consentChk').checked)return;sessionStorage.setItem('mdhC','y');document.getElementById('consent').style.display='none';toast('üöÄ','Welcome to MDH TESTER!');}
function toggleTheme(){isDark=!isDark;document.documentElement.setAttribute('data-theme',isDark?'dark':'light');document.getElementById('themeIco').textContent=isDark?'üåô':'‚òÄÔ∏è';localStorage.setItem('mdhT',isDark?'dark':'light');}
function toggleSound(){soundOn=!soundOn;document.getElementById('soundBtn').classList.toggle('muted',!soundOn);localStorage.setItem('mdhSnd',soundOn?'on':'off');toast(soundOn?'üîî':'üîï',soundOn?'Sound on':'Sound off');}
function playSound(type){if(!soundOn)return;try{const ctx=new(window.AudioContext||window.webkitAudioContext)();const o=ctx.createOscillator();const g=ctx.createGain();o.connect(g);g.connect(ctx.destination);g.gain.value=0.04;if(type==='done'){o.frequency.value=880;o.type='sine';o.start();o.stop(ctx.currentTime+0.1);setTimeout(()=>{const o2=ctx.createOscillator();const g2=ctx.createGain();o2.connect(g2);g2.connect(ctx.destination);g2.gain.value=0.04;o2.frequency.value=1100;o2.type='sine';o2.start();o2.stop(ctx.currentTime+0.12);},100);}else{o.frequency.value=520;o.type='sine';o.start();o.stop(ctx.currentTime+0.06);}}catch(e){}}

function switchMode(m){curMode=m;document.querySelectorAll('.tab[data-mode]').forEach(b=>b.classList.toggle('active',b.dataset.mode===m));['singleMode','megaMode','customMode','demoMode'].forEach(id=>document.getElementById(id).classList.add('hidden'));document.getElementById(m+'Mode').classList.remove('hidden');}
function buildCats(){const cats=[...new Set(P.map(p=>p.cat))];const c=document.getElementById('catFilters');cats.forEach(cat=>{const n=P.filter(p=>p.cat===cat).length;const b=document.createElement('button');b.className='chip';b.dataset.cat=cat;b.onclick=()=>filterCat(cat);b.textContent=cat+' '+n;c.appendChild(b);});}
function buildProvSel(){const s=document.getElementById('apiProv');[...new Set(P.map(p=>p.cat))].forEach(cat=>{const g=document.createElement('optgroup');g.label=cat;P.filter(p=>p.cat===cat).forEach(p=>{const o=document.createElement('option');o.value=p.id;o.textContent=p.icon+' '+p.name;g.appendChild(o);});s.appendChild(g);});}
function buildMegaProvSel(){const s=document.getElementById('megaManualProv');[...new Set(P.map(p=>p.cat))].forEach(cat=>{const g=document.createElement('optgroup');g.label=cat;P.filter(p=>p.cat===cat).forEach(p=>{const o=document.createElement('option');o.value=p.id;o.textContent=p.icon+' '+p.name;g.appendChild(o);});s.appendChild(g);});}
function buildDemos(){const c=document.getElementById('demoGrid');DEMOS.forEach(d=>{const el=document.createElement('div');el.className='svc-card';el.onclick=()=>runDemo(d);el.innerHTML=`<span class="svc-icon">${d.icon}</span><div><div class="svc-name">${d.name}</div></div>`;c.appendChild(el);});}

function renderGrid(){const g=document.getElementById('svcGrid');const s=(document.getElementById('searchInp')?.value||'').toLowerCase();g.innerHTML='';let n=0;P.forEach(p=>{if(curCat!=='all'&&p.cat!==curCat)return;if(s&&!p.name.toLowerCase().includes(s)&&!p.cat.toLowerCase().includes(s)&&!p.id.includes(s))return;n++;const d=document.createElement('div');d.className='svc-card';d.onclick=()=>{switchMode('single');document.getElementById('apiProv').value=p.id;onProvChange();document.getElementById('apiKey').focus();};d.innerHTML=`<span class="svc-icon">${p.icon}</span><div style="min-width:0"><div class="svc-name">${p.name}</div><div class="svc-cat">${p.cat}</div></div>`;g.appendChild(d);});document.getElementById('visCnt').textContent=n+' / '+P.length;}
function filterCat(c){curCat=c;document.querySelectorAll('.chip[data-cat]').forEach(ch=>ch.classList.toggle('active',ch.dataset.cat===c));renderGrid();}
function onProvChange(){const p=P.find(x=>x.id===document.getElementById('apiProv').value);const info=document.getElementById('provInfo');if(p?.info){document.getElementById('provInfoT').textContent=p.info;info.classList.remove('hidden');}else info.classList.add('hidden');}
function mask(k){if(!k)return'‚Ä¢‚Ä¢‚Ä¢‚Ä¢';if(k.length>14)return k.slice(0,6)+'‚Ä¢‚Ä¢‚Ä¢'+k.slice(-4);if(k.length>8)return k.slice(0,3)+'‚Ä¢‚Ä¢‚Ä¢'+k.slice(-3);return'‚Ä¢‚Ä¢‚Ä¢';}
function fmtBytes(b){if(b<1024)return b+' B';if(b<1048576)return(b/1024).toFixed(1)+' KB';return(b/1048576).toFixed(1)+' MB';}
function escH(s){return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');}

function setupDrop(){const dz=document.getElementById('dropZone');['dragenter','dragover'].forEach(e=>dz.addEventListener(e,ev=>{ev.preventDefault();dz.classList.add('active');}));['dragleave','drop'].forEach(e=>dz.addEventListener(e,ev=>{ev.preventDefault();dz.classList.remove('active');}));dz.addEventListener('drop',ev=>{const f=ev.dataTransfer.files;if(f.length){const r=new FileReader();r.onload=e=>{document.getElementById('megaInput').value=e.target.result;toast('üìÅ','File loaded ‚Äî '+f[0].name);};r.readAsText(f[0]);}});}

function getDelay(){
    const base=parseInt(document.getElementById('megaDelay').value)||0;
    const strat=document.getElementById('megaDelayStrat')?.value||'fixed';
    if(strat==='random')return Math.max(0,base+Math.floor((Math.random()-.5)*base));
    return base;
}

// ===== MEGA BULK =====
function detectProvider(key){
    if(key.startsWith('sk-ant-'))return'anthropic';if(key.startsWith('sk-proj-'))return'openai';if(key.startsWith('sk-svcacct-'))return'openai';if(key.startsWith('sk-'))return'openai';
    if(key.startsWith('gsk_'))return'groq';if(/^gh[pousr]_/.test(key))return'github';if(key.startsWith('glpat-'))return'gitlab';
    if(/^[sr]k_(live|test)_/.test(key))return'stripe';if(key.startsWith('SG.'))return'sendgrid';if(/^xox[bp]-/.test(key))return'slack';
    if(key.startsWith('hf_'))return'huggingface';if(key.startsWith('r8_'))return'replicate';if(key.startsWith('npm_'))return'npm';
    if(key.startsWith('re_'))return'resend';if(key.startsWith('AIza'))return'gemini';if(key.startsWith('ntn_'))return'notion';
    if(key.startsWith('lin_api_'))return'linear';if(key.startsWith('key-')&&key.length===36)return'mailgun';
    if(key.startsWith('vercel_'))return'vercel';if(key.startsWith('sbp_'))return'supabase';if(key.startsWith('pcsk_'))return'pinecone';
    if(key.startsWith('figd_'))return'figma';if(key.startsWith('xkeysib-'))return'brevo';
    if(/^[0-9]{8,10}:[A-Za-z0-9_-]{35}$/.test(key))return'telegram';
    if(/^[MN][A-Za-z0-9]{23,}\.[A-Za-z0-9_-]{6}\.[A-Za-z0-9_-]{27,}$/.test(key))return'discord';
    return null;
}

function megaAnalyze(){
    const raw=document.getElementById('megaInput').value;if(!raw.trim()){toast('‚ö†Ô∏è','Paste keys first');return;}
    const manualProv=document.getElementById('megaManualProv').value;
    const manualProvObj=manualProv?P.find(p=>p.id===manualProv):null;
    let found=[];const seen=new Set();let dupes=0;
    if(manualProv){
        raw.split(/[\n,;]+/).map(l=>l.trim()).filter(l=>l.length>=8).forEach(line=>{
            let c=line.replace(/^(?:export\s+)?[A-Z_0-9]+=["']?/i,'').replace(/["';,\s]+$/,'');
            if(c.length<8)return;if(seen.has(c)){dupes++;return;}seen.add(c);
            found.push({key:c,provider:manualProv,patName:manualProvObj?.name||manualProv,status:'pending',code:null,latency:0,response:null,responseSize:0,headers:null,timestamp:null});
        });
    }else{
        KEY_PAT.forEach(pat=>{if(!pat.prov)return;(raw.match(pat.rx)||[]).forEach(m=>{if(seen.has(m)){dupes++;return;}seen.add(m);found.push({key:m,provider:pat.prov,patName:pat.name,status:'pending',code:null,latency:0,response:null,responseSize:0,headers:null,timestamp:null});});});
        raw.split(/[\n,;]+/).map(l=>l.trim()).filter(l=>l.length>=10).forEach(line=>{
            let c=line.replace(/^(?:export\s+)?[A-Z_0-9]+=["']?/i,'').replace(/["';,\s]+$/,'');
            if(c.length<10||seen.has(c))return;let prov=detectProvider(c);
            if(prov||c.length>=20){seen.add(c);found.push({key:c,provider:prov,patName:prov?P.find(p=>p.id===prov)?.name:'Unknown',status:'pending',code:null,latency:0,response:null,responseSize:0,headers:null,timestamp:null});}
        });
    }
    if(!found.length){toast('‚ö†Ô∏è',manualProv?'No keys found':'No keys detected. Try Manual mode.');return;}
    megaKeys=found;expandedRow=-1;megaSortCol='';megaSortDir=1;
    const providers=[...new Set(found.map(f=>f.provider).filter(Boolean))];
    document.getElementById('msTotalKeys').textContent=found.length;document.getElementById('msProviders').textContent=providers.length;
    document.getElementById('msDupes').textContent=dupes;document.getElementById('msDetected').textContent=found.filter(f=>f.provider).length;
    document.getElementById('msUnknown').textContent=found.filter(f=>!f.provider).length;
    const bd=document.getElementById('msBreakdown');bd.innerHTML='';
    if(manualProv)bd.innerHTML=`<span class="badge badge-cyan">üìå ${manualProvObj?.icon||''} ${manualProvObj?.name||manualProv}</span>`;
    const grouped={};found.forEach(f=>{const n=f.patName||'Unknown';grouped[n]=(grouped[n]||0)+1;});
    Object.entries(grouped).sort((a,b)=>b[1]-a[1]).forEach(([name,count])=>{const prov=P.find(p=>p.name===name);bd.innerHTML+=`<span class="badge badge-purple">${prov?.icon||'üîë'} ${name}: ${count}</span>`;});
    const useDeep=document.getElementById('megaDeepTest').checked;
    if(useDeep){const cfg=getDeepCfg();bd.innerHTML+=`<span class="badge badge-yellow">üß™ Deep: "${cfg.prompt}" tok:${cfg.maxTokens}</span>`;}
    document.getElementById('megaSummary').classList.remove('hidden');document.getElementById('megaStartBtn').disabled=false;
    document.getElementById('megaRetestBtn').classList.add('hidden');megaRenderResults();
    toast('üîç',`${found.length} keys`+(manualProv?` for ${manualProvObj?.name}`:` from ${providers.length} providers`)+(useDeep?' (Deep)':''));
}

async function megaStart(){
    if(megaRunning)return;
    const testable=megaKeys.filter(k=>k.provider&&(k.status==='pending'||k.status==='queued'));
    if(!testable.length){toast('‚ö†Ô∏è','No testable keys');return;}
    megaRunning=true;megaPaused=false;megaCancelled=false;megaDone=0;megaValid=0;megaInvalid=0;megaError=0;megaStartTime=Date.now();
    megaKeys.forEach(k=>{if(k.status==='pending'&&k.provider)k.status='queued';});
    document.getElementById('megaStartBtn').disabled=true;document.getElementById('megaPauseBtn').classList.remove('hidden');
    document.getElementById('megaCancelBtn').classList.remove('hidden');document.getElementById('megaRetestBtn').classList.add('hidden');
    document.getElementById('megaProgress').classList.remove('hidden');document.getElementById('megaFilters').classList.remove('hidden');
    document.getElementById('mpLive').classList.remove('hidden');
    const conc=parseInt(document.getElementById('megaConc').value)||5;
    const timeout=(parseInt(document.getElementById('megaTimeout').value)||15)*1000;
    const retries=parseInt(document.getElementById('megaRetry').value)||0;
    const useDeep=document.getElementById('megaDeepTest').checked;
    const deepCfg=useDeep?getDeepCfg():null;
    const respLimit=parseInt(document.getElementById('megaRespLimit').value);
    const delayStrat=document.getElementById('megaDelayStrat')?.value||'fixed';
    const baseDelay=parseInt(document.getElementById('megaDelay').value)||0;
    const total=testable.length;let idx=0;let backoffDelay=baseDelay;
    async function worker(){
        while(idx<megaKeys.length&&!megaCancelled){
            if(megaPaused){await new Promise(r=>setTimeout(r,200));continue;}
            const ki=idx++;const item=megaKeys[ki];
            if(!item||!item.provider||item.status!=='queued')continue;
            const prov=P.find(p=>p.id===item.provider);
            if(!prov){item.status='error';item.code='N/A';megaError++;megaDone++;updMegaProg(total);continue;}
            item.status='testing';item.timestamp=new Date().toLocaleTimeString();megaRenderResults();
            let testFn;
            if(useDeep){const df=buildDeepFetch(item.provider,item.key,deepCfg);testFn=df?()=>df:()=>prov.test(item.key);}
            else testFn=()=>prov.test(item.key);
            let success=false;
            for(let attempt=0;attempt<=retries&&!success&&!megaCancelled;attempt++){
                try{
                    const t0=Date.now();const resp=await testFn();
                    item.latency=Date.now()-t0;item.code=resp.status;
                    try{const txt=await resp.text();item.responseSize=txt.length;item.response=respLimit>0?txt.slice(0,respLimit):txt;}catch{item.response=null;}
                    let rh='';try{resp.headers.forEach((v,k)=>{rh+=k+': '+v+'\n';});}catch{}item.headers=rh;
                    if(resp.ok||resp.status===200||resp.status===201){item.status='valid';megaValid++;}
                    else if(resp.status===401||resp.status===403){item.status='invalid';megaInvalid++;}
                    else if(resp.status===429){item.status='valid';megaValid++;item.code='429‚ö°';}
                    else{item.status='invalid';megaInvalid++;}
                    success=true;backoffDelay=baseDelay;
                }catch(e){if(attempt>=retries){item.status='error';item.code='ERR';item.latency=0;item.response='Error: '+e.message;megaError++;}
                if(delayStrat==='backoff')backoffDelay=Math.min(backoffDelay*2,10000);}
            }
            megaDone++;updMegaProg(total);megaRenderResults();
            document.title=`(${Math.round(megaDone/total*100)}%) MDH TESTER`;
            let d=delayStrat==='random'?Math.max(0,baseDelay+Math.floor((Math.random()-.5)*baseDelay)):delayStrat==='backoff'?backoffDelay:baseDelay;
            if(d>0)await new Promise(r=>setTimeout(r,d));
        }
    }
    const workers=[];for(let w=0;w<Math.min(conc,testable.length);w++)workers.push(worker());
    await Promise.all(workers);
    megaRunning=false;document.title=ORIG_TITLE;
    document.getElementById('megaStartBtn').disabled=false;
    document.getElementById('megaPauseBtn').classList.add('hidden');document.getElementById('megaResumeBtn').classList.add('hidden');
    document.getElementById('megaCancelBtn').classList.add('hidden');document.getElementById('mpLive').classList.add('hidden');
    if(megaError>0||megaInvalid>0)document.getElementById('megaRetestBtn').classList.remove('hidden');
    updMegaProg(total);megaRenderResults();renderProvStats();playSound('done');
    if(megaValid>0&&megaInvalid===0&&megaError===0)fireConfetti();
    toast('‚úÖ',`‚úÖ${megaValid} ¬∑ ‚ùå${megaInvalid} ¬∑ ‚ö†Ô∏è${megaError}`);
    stats.t+=total;stats.v+=megaValid;stats.i+=megaInvalid+megaError;
    stats.l=megaKeys.filter(k=>k.latency>0).map(k=>k.latency).slice(-100);
    localStorage.setItem('mdhS',JSON.stringify(stats));updStats();
}

function megaPause(){megaPaused=true;document.getElementById('megaPauseBtn').classList.add('hidden');document.getElementById('megaResumeBtn').classList.remove('hidden');toast('‚è∏','Paused');}
function megaResume(){megaPaused=false;document.getElementById('megaResumeBtn').classList.add('hidden');document.getElementById('megaPauseBtn').classList.remove('hidden');toast('‚ñ∂','Resumed');}
function megaCancel(){megaCancelled=true;megaRunning=false;document.getElementById('megaPauseBtn').classList.add('hidden');document.getElementById('megaResumeBtn').classList.add('hidden');document.getElementById('megaCancelBtn').classList.add('hidden');document.getElementById('megaStartBtn').disabled=false;document.getElementById('mpLive').classList.add('hidden');if(megaError>0)document.getElementById('megaRetestBtn').classList.remove('hidden');document.title=ORIG_TITLE;toast('‚èπ','Stopped');}
function megaRetest(){megaKeys.forEach(k=>{if(k.status==='error'||k.status==='invalid')k.status='pending';});document.getElementById('megaRetestBtn').classList.add('hidden');megaRenderResults();toast('üîÑ','Re-testing failed keys');megaStart();}

function updMegaProg(total){
    const pct=total?Math.round(megaDone/total*100):0;
    document.getElementById('mpText').textContent=`${megaDone} / ${total} (${pct}%)`;
    document.getElementById('mpBar').style.width=pct+'%';
    document.getElementById('mpValid').textContent='‚úÖ '+megaValid;document.getElementById('mpInvalid').textContent='‚ùå '+megaInvalid;
    document.getElementById('mpError').textContent='‚ö†Ô∏è '+megaError;document.getElementById('mpSkip').textContent='‚è≥ '+(total-megaDone);
    if(megaDone>0&&megaDone<total){const el=(Date.now()-megaStartTime)/1000;const rem=Math.round((total-megaDone)/(megaDone/el));document.getElementById('mpEta').textContent=`ETA: ${rem>60?Math.floor(rem/60)+'m ':''}${rem%60}s`;}else if(megaDone>=total){document.getElementById('mpEta').textContent='‚úÖ Done';}
    const vp=total?megaValid/total*100:0,ip=total?megaInvalid/total*100:0,ep=total?megaError/total*100:0;
    document.getElementById('mpStatsBar').innerHTML=`<div style="width:${vp}%;background:var(--green)"></div><div style="width:${ip}%;background:var(--red)"></div><div style="width:${ep}%;background:var(--yellow)"></div><div style="width:${100-vp-ip-ep}%;background:var(--border)"></div>`;
    document.getElementById('mfAll').textContent=megaKeys.length;
    document.getElementById('mfValid').textContent=megaKeys.filter(k=>k.status==='valid').length;
    document.getElementById('mfInvalid').textContent=megaKeys.filter(k=>k.status==='invalid').length;
    document.getElementById('mfError').textContent=megaKeys.filter(k=>k.status==='error').length;
    document.getElementById('mfPending').textContent=megaKeys.filter(k=>['pending','queued','testing'].includes(k.status)).length;
    if(megaDone>0){document.getElementById('mpDonut').classList.remove('hidden');const vpct=total?Math.round(megaValid/total*100):0;document.getElementById('donutPct').textContent=vpct+'%';const ipct=total?Math.round(megaInvalid/total*100):0;const epct=total?Math.round(megaError/total*100):0;document.getElementById('donutChart').style.background=`conic-gradient(var(--green) 0% ${vpct}%,var(--red) ${vpct}% ${vpct+ipct}%,var(--yellow) ${vpct+ipct}% ${vpct+ipct+epct}%,var(--border) ${vpct+ipct+epct}% 100%)`;}
}

function megaFilter(f){megaFilterMode=f;document.querySelectorAll('.pill[data-mf]').forEach(b=>b.classList.toggle('active',b.dataset.mf===f));expandedRow=-1;megaRenderResults();}
function megaSort(col){if(megaSortCol===col)megaSortDir*=-1;else{megaSortCol=col;megaSortDir=1;}megaRenderResults();}

function megaRenderResults(){
    const c=document.getElementById('megaResultsInner');document.getElementById('megaResults').classList.remove('hidden');
    const search=(document.getElementById('megaSearchInp')?.value||'').toLowerCase();
    let filtered=megaKeys;
    if(megaFilterMode==='valid')filtered=megaKeys.filter(k=>k.status==='valid');
    else if(megaFilterMode==='invalid')filtered=megaKeys.filter(k=>k.status==='invalid');
    else if(megaFilterMode==='error')filtered=megaKeys.filter(k=>k.status==='error');
    else if(megaFilterMode==='pending')filtered=megaKeys.filter(k=>['pending','queued','testing'].includes(k.status));
    if(search)filtered=filtered.filter(k=>{const prov=P.find(p=>p.id===k.provider);return k.key.toLowerCase().includes(search)||(prov?.name||'').toLowerCase().includes(search);});
    if(megaSortCol){filtered=[...filtered].sort((a,b)=>{let va,vb;switch(megaSortCol){case'key':va=a.key;vb=b.key;break;case'provider':va=a.patName||'';vb=b.patName||'';break;case'status':const ord={valid:0,invalid:1,error:2,testing:3,queued:4,pending:5};va=ord[a.status]??9;vb=ord[b.status]??9;break;case'latency':va=a.latency||99999;vb=b.latency||99999;break;default:return 0;}if(typeof va==='string')return megaSortDir*va.localeCompare(vb);return megaSortDir*(va-vb);});}
    const si=col=>megaSortCol===col?(megaSortDir===1?' ‚Üë':' ‚Üì'):' ‚Üï';
    let html=`<div class="result-row row-header"><span>#</span><span onclick="megaSort('key')">Key${si('key')}</span><span class="col-prov" onclick="megaSort('provider')">Provider${si('provider')}</span><span onclick="megaSort('status')">Status${si('status')}</span><span onclick="megaSort('latency')">Time${si('latency')}</span><span></span></div>`;
    filtered.slice(0,500).forEach((item,i)=>{
        const idx=megaKeys.indexOf(item);
        const ico={valid:'‚úÖ',invalid:'‚ùå',error:'‚ö†Ô∏è',pending:'‚è≥',queued:'üîÑ',testing:'‚è≥'}[item.status]||'‚ùì';
        const cls={valid:'row-valid',invalid:'row-invalid',error:'row-error',testing:'row-testing'}[item.status]||'';
        const prov=P.find(p=>p.id===item.provider);
        const sizeStr=item.responseSize?fmtBytes(item.responseSize):'';
        html+=`<div class="result-row ${cls}" onclick="toggleExpand(${idx},event)"><span style="color:var(--text3);font-size:9px">${i+1}</span><span class="mono truncate" style="font-size:9px" title="${escH(item.key)}">${escH(mask(item.key))}</span><span class="col-prov" style="font-size:9px;color:var(--text2)">${prov?.icon||'üîë'} ${prov?.name||'?'}</span><span style="font-size:9px;font-weight:600">${ico} ${item.code||''}</span><span style="font-size:9px;color:var(--text3)">${item.latency?item.latency+'ms':'‚Äî'}</span><span><button onclick="event.stopPropagation();cpClip('${escH(item.key)}','Copied!')" style="background:none;border:none;cursor:pointer;font-size:10px;color:var(--text3)" title="Copy">üìã</button></span></div>`;
        // Expand detail
        html+=`<div class="expand-detail${expandedRow===idx?' open':''}" id="expand-${idx}"><div style="font-size:10px"><div class="flex items-center justify-between flex-wrap gap-2 mb-2"><div class="flex gap-1 flex-wrap"><span class="badge badge-purple">${prov?.icon||''} ${prov?.name||'?'}</span><span class="badge ${item.status==='valid'?'badge-green':item.status==='invalid'?'badge-red':'badge-yellow'}">${item.status.toUpperCase()}</span>${item.code?`<span class="badge badge-blue">HTTP ${item.code}</span>`:''}${item.latency?`<span class="badge badge-cyan">${item.latency}ms</span>`:''}${sizeStr?`<span class="badge badge-orange">${sizeStr}</span>`:''}${item.timestamp?`<span style="font-size:8px;color:var(--text3)">@ ${item.timestamp}</span>`:''}</div><div class="flex gap-1"><button onclick="event.stopPropagation();cpClip('${escH(item.key)}','Key copied!')" class="btn btn-xs btn-secondary">üìã Key</button>${item.response?`<button onclick="event.stopPropagation();cpClip(megaKeys[${idx}].response,'Response copied!')" class="btn btn-xs btn-secondary">üìã Response</button>`:''}<button onclick="event.stopPropagation();retestOne(${idx})" class="btn btn-xs btn-secondary">üîÑ</button></div></div>${item.response?`<div class="expand-response">${formatExpandResponse(item.response)}</div>`:''}</div></div>`;
    });
    if(filtered.length>500)html+=`<div style="text-align:center;padding:10px;font-size:10px;color:var(--text3)">Showing 500 of ${filtered.length}</div>`;
    if(!filtered.length)html+=`<div style="text-align:center;padding:20px;font-size:11px;color:var(--text3)">No results</div>`;
    c.innerHTML=html;
}

function formatExpandResponse(resp){
    try{const parsed=JSON.parse(resp);return syntaxHL(JSON.stringify(parsed,null,2));}catch{return escH(resp);}
}
function syntaxHL(json){return escH(json).replace(/"([^"]+)":/g,'<span class="jk">"$1"</span>:').replace(/: "([^"]*)"/g,': <span class="js">"$1"</span>').replace(/: (\d+\.?\d*)/g,': <span class="jn">$1</span>').replace(/: (true|false)/g,': <span class="jb">$1</span>').replace(/: (null)/g,': <span class="jnl">$1</span>');}

function toggleExpand(idx,e){if(e&&(e.target.tagName==='BUTTON'||e.target.closest('button')))return;expandedRow=expandedRow===idx?-1:idx;megaRenderResults();}

async function retestOne(idx){
    const item=megaKeys[idx];if(!item||!item.provider)return;
    const prov=P.find(p=>p.id===item.provider);if(!prov)return;
    const useDeep=document.getElementById('megaDeepTest').checked;const deepCfg=useDeep?getDeepCfg():null;
    item.status='testing';item.code=null;item.latency=0;item.response=null;item.responseSize=0;item.timestamp=new Date().toLocaleTimeString();megaRenderResults();
    try{const t0=Date.now();
        let resp;
        if(useDeep){const df=buildDeepFetch(item.provider,item.key,deepCfg);resp=df?await df:await prov.test(item.key);}
        else resp=await prov.test(item.key);
        item.latency=Date.now()-t0;item.code=resp.status;
        try{const txt=await resp.text();item.responseSize=txt.length;const limit=parseInt(document.getElementById('megaRespLimit').value);item.response=limit>0?txt.slice(0,limit):txt;}catch{}
        if(resp.ok||resp.status===200||resp.status===201||resp.status===429)item.status='valid';else item.status='invalid';
    }catch(e){item.status='error';item.code='ERR';item.response='Error: '+e.message;}
    megaRenderResults();toast(item.status==='valid'?'‚úÖ':'‚ùå',`Re-test: ${item.status}`);
}

function renderProvStats(){
    document.getElementById('megaProvStats').classList.remove('hidden');
    const byProv={};megaKeys.forEach(k=>{const n=k.patName||'Unknown';if(!byProv[n])byProv[n]={total:0,valid:0,invalid:0,error:0,icon:'üîë'};byProv[n].total++;byProv[n][k.status==='valid'?'valid':k.status==='invalid'?'invalid':'error']++;const p=P.find(x=>x.name===n);if(p)byProv[n].icon=p.icon;});
    let html='';
    Object.entries(byProv).sort((a,b)=>b[1].total-a[1].total).forEach(([name,d])=>{
        const vPct=d.total?Math.round(d.valid/d.total*100):0;
        html+=`<div class="prov-stat"><span style="font-size:13px">${d.icon}</span><div style="flex:1;min-width:0"><div class="flex items-center justify-between"><span style="font-size:10px;font-weight:600;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${escH(name)}</span><span style="font-size:9px;color:var(--text3)">${d.valid}/${d.total}</span></div><div class="prov-stat-bar"><div class="prov-stat-fill" style="width:${vPct}%;background:${vPct>60?'var(--green)':vPct>30?'var(--yellow)':'var(--red)'}"></div></div></div></div>`;
    });
    document.getElementById('provStatsGrid').innerHTML=html;
}

function megaExportKeys(type){let keys=megaKeys;if(type==='valid')keys=megaKeys.filter(k=>k.status==='valid');if(!keys.length){toast('‚ö†Ô∏è','Nothing');return;}if(type==='all'){dl('Key,Provider,Status,Code,Latency,Size\n'+keys.map(k=>`"${k.key}","${k.patName||'?'}","${k.status}","${k.code||''}","${k.latency||0}","${k.responseSize||0}"`).join('\n'),'mdh-results.csv','text/csv');}else{dl(keys.map(k=>k.key).join('\n'),`mdh-${type}-keys.txt`,'text/plain');}toast('üíæ',`Exported ${keys.length}`);}
function megaCopyWorking(){const v=megaKeys.filter(k=>k.status==='valid').map(k=>k.key).join('\n');if(!v){toast('‚ö†Ô∏è','None');return;}cpClip(v,`Copied ${megaKeys.filter(k=>k.status==='valid').length} keys!`);}
function megaExportPostman(){const valid=megaKeys.filter(k=>k.status==='valid');if(!valid.length){toast('‚ö†Ô∏è','None');return;}const items=valid.map(k=>{const prov=P.find(p=>p.id===k.provider);return{name:`${prov?.name||'API'} - ${mask(k.key)}`,request:{method:'GET',header:[{key:'Authorization',value:'Bearer '+k.key}],url:{raw:`https://api.example.com/${k.provider}`}}};});dl(JSON.stringify({info:{name:'MDH TESTER',schema:'https://schema.getpostman.com/json/collection/v2.1.0/collection.json'},item:items},null,2),'mdh-postman.json','application/json');toast('üìÆ','Exported!');}

// ===== SINGLE =====
async function testSingle(deep=false){
    const pid=document.getElementById('apiProv').value;const key=document.getElementById('apiKey').value.trim();
    if(!pid){toast('‚ö†Ô∏è','Select provider');return;}if(!key){toast('‚ö†Ô∏è','Enter key');return;}
    const prov=P.find(p=>p.id===pid);const btn=deep?document.getElementById('testDeepBtn'):document.getElementById('testBtn');
    const other=deep?document.getElementById('testBtn'):document.getElementById('testDeepBtn');
    btn.disabled=true;other.disabled=true;btn.innerHTML='<span class="spinner"></span> Testing...';
    let testFn;
    if(deep){const cfg=getDeepCfg();const df=buildDeepFetch(pid,key,cfg);testFn=df?()=>df:()=>prov.test(key);}else testFn=()=>prov.test(key);
    const masked=mask(key);const t0=Date.now();
    try{const resp=await testFn();const lat=Date.now()-t0;let body='';try{body=await resp.text();}catch{}let parsed;try{parsed=JSON.parse(body);}catch{}
        lastStat=resp.status;lastRaw=parsed?JSON.stringify(parsed,null,2):body;
        let rh='';resp.headers.forEach((v,k)=>rh+=k+': '+v+'\n');lastHdrs=rh||'(CORS restricted)';
        lastReqI=`${resp.url||'URL hidden'}\nMethod: ${deep?'POST':'GET'}\nStatus: ${resp.status}\nLatency: ${lat}ms\nKey: ${masked}\nResponse: ${fmtBytes(body.length)}`;
        const type=resp.ok?'valid':(resp.status===401||resp.status===403)?'invalid':resp.status===429?'warn':'unknown';
        showRes(type,`${resp.ok?'‚úÖ':'‚ùå'} ${prov.name}`,`${resp.status} ¬∑ ${masked} ¬∑ ${lat}ms`,lat,resp.status,body.length);
        addHist(prov,masked,type,resp.status,lat);stats.t++;if(resp.ok||resp.status===429){stats.v++;stats.l.push(lat);}else stats.i++;
    }catch(e){const lat=Date.now()-t0;lastRaw='Error: '+e.message;lastHdrs='(Failed)';lastStat=0;lastReqI=`Error: ${e.message}`;
        showRes('error','üí• '+prov.name,e.message.slice(0,50),lat,0,0);stats.t++;stats.i++;addHist(prov,masked,'error','CORS',lat);}
    localStorage.setItem('mdhS',JSON.stringify(stats));updStats();btn.disabled=false;other.disabled=false;btn.innerHTML=deep?'üß™ Deep Test':'‚ö° Quick Test';playSound('done');
}

// ===== CUSTOM =====
async function runCustom(){const method=document.getElementById('cMethod').value;const url=document.getElementById('cUrl').value.trim();if(!url){toast('‚ö†Ô∏è','Enter URL');return;}const headers={};document.querySelectorAll('.header-row').forEach(r=>{const k=r.querySelector('.chk')?.value?.trim();const v=r.querySelector('.chv')?.value?.trim();if(k&&v)headers[k]=v;});const body=document.getElementById('cBody').value.trim();const btn=document.getElementById('cBtn');btn.disabled=true;btn.innerHTML='<span class="spinner"></span>';const opts={method,headers};if(body&&['POST','PUT','PATCH'].includes(method)){opts.body=body;if(!headers['Content-Type'])headers['Content-Type']='application/json';}const t0=Date.now();try{const resp=await fetch(url,opts);const lat=Date.now()-t0;let b='';try{b=await resp.text();}catch{}let parsed;try{parsed=JSON.parse(b);}catch{}lastStat=resp.status;lastRaw=parsed?JSON.stringify(parsed,null,2):b;let rh='';resp.headers.forEach((v,k)=>rh+=k+': '+v+'\n');lastHdrs=rh;lastReqI=`${method} ${url}\nStatus: ${resp.status}\nLatency: ${lat}ms\nResponse: ${fmtBytes(b.length)}`;showRes(resp.ok?'valid':'invalid',`${resp.ok?'‚úÖ':'‚ùå'} ${resp.status}`,`${method} ¬∑ ${lat}ms`,lat,resp.status,b.length);}catch(e){const lat=Date.now()-t0;lastRaw='Error: '+e.message;lastHdrs='(Failed)';lastStat=0;lastReqI=`${method} ${url}\nError: ${e.message}`;showRes('error','üí• Failed',e.message.slice(0,60),lat,0,0);}btn.disabled=false;btn.innerHTML='üöÄ Send Request';}
function addCH(){const c=document.getElementById('cHeaders');const d=document.createElement('div');d.className='header-row flex gap-2 mb-2';d.innerHTML='<input type="text" placeholder="Header" class="input input-mono chk" style="flex:1;padding:7px 9px;font-size:10px"><input type="text" placeholder="Value" class="input input-mono chv" style="flex:1;padding:7px 9px;font-size:10px"><button onclick="this.parentElement.remove()" style="color:var(--red);background:none;border:none;cursor:pointer;font-size:13px">‚úï</button>';c.appendChild(d);}
async function runDemo(d){const t0=Date.now();try{const r=await fetch(d.url);const lat=Date.now()-t0;let b='';try{b=await r.text();}catch{}let p;try{p=JSON.parse(b);}catch{}lastStat=r.status;lastRaw=p?JSON.stringify(p,null,2):b;let rh='';r.headers.forEach((v,k)=>rh+=k+': '+v+'\n');lastHdrs=rh;lastReqI=`GET ${d.url}\n${r.status} ¬∑ ${lat}ms ¬∑ ${fmtBytes(b.length)}`;showRes('valid',`‚úÖ ${d.name}`,`${r.status} ¬∑ ${lat}ms`,lat,r.status,b.length);}catch(e){lastRaw='Error: '+e.message;lastHdrs='';lastStat=0;lastReqI='Error';showRes('error','üí• '+d.name,e.message,0,0,0);}}

// ===== RESULT DISPLAY =====
function showRes(type,title,sub,lat,status,size){
    const c=document.getElementById('resultCard');c.classList.remove('hidden','res-valid','res-invalid','res-error');
    c.classList.add({valid:'res-valid',invalid:'res-invalid',error:'res-error',warn:'res-error'}[type]||'');
    const colors={valid:{bg:'rgba(34,197,94,.08)',badge:'badge-green'},invalid:{bg:'rgba(239,68,68,.08)',badge:'badge-red'},warn:{bg:'rgba(234,179,8,.08)',badge:'badge-yellow'},error:{bg:'rgba(239,68,68,.08)',badge:'badge-red'},unknown:{bg:'rgba(234,179,8,.08)',badge:'badge-yellow'}};
    const cfg=colors[type]||colors.unknown;
    document.getElementById('rIco').style.background=cfg.bg;document.getElementById('rIco').textContent={valid:'‚úÖ',invalid:'‚ùå',warn:'‚ö†Ô∏è',error:'üí•',unknown:'‚ùì'}[type]||'‚ùì';
    document.getElementById('rTitle').textContent=title;document.getElementById('rSub').textContent=sub;
    document.getElementById('rLat').textContent=lat+'ms';document.getElementById('rSize').textContent=size?fmtBytes(size):'';
    const sb=document.getElementById('rStat');sb.textContent=status?'HTTP '+status:'Error';sb.className='badge '+cfg.badge;
    const pct=Math.min(lat/3000*100,100);const bar=document.getElementById('rBar');bar.style.width=pct+'%';bar.style.background=lat<300?'var(--green)':lat<1000?'var(--yellow)':'var(--red)';
    renderResBody();document.getElementById('rHdrs').textContent=lastHdrs;document.getElementById('rReq').textContent=lastReqI;
    renderSnip();renderExpl(status);swRT('resp');c.scrollIntoView({behavior:'smooth',block:'nearest'});
}
function renderResBody(){const el=document.getElementById('rBody');if(jvMode==='tree'){try{el.innerHTML=buildJT(JSON.parse(lastRaw));}catch{el.textContent=lastRaw;}}else{try{el.innerHTML=syntaxHL(lastRaw);}catch{el.textContent=lastRaw;}}}
function toggleJV(){jvMode=jvMode==='raw'?'tree':'raw';document.getElementById('jvBtn').textContent=jvMode==='tree'?'üìù Raw':'üå≥ Tree';renderResBody();}
function buildJT(o,d=0){if(o===null)return'<span class="jnl">null</span>';if(typeof o==='boolean')return`<span class="jb">${o}</span>`;if(typeof o==='number')return`<span class="jn">${o}</span>`;if(typeof o==='string')return`<span class="js">"${escH(o.length>200?o.slice(0,200)+'‚Ä¶':o)}"</span>`;const isA=Array.isArray(o);const keys=Object.keys(o);if(!keys.length)return isA?'[]':'{}';const id='j'+Math.random().toString(36).slice(2,7);let h=`<span class="jt" onclick="const e=document.getElementById('${id}');e.classList.toggle('jchid');this.textContent=e.classList.contains('jchid')?'‚ñ∂':'‚ñº'">‚ñº</span>${isA?'[':'{'}<div class="jcoll" id="${id}">`;keys.forEach((k,i)=>{const cm=i<keys.length-1?',':'';h+=isA?`<div>${buildJT(o[k],d+1)}${cm}</div>`:`<div><span class="jk">"${escH(k)}"</span>: ${buildJT(o[k],d+1)}${cm}</div>`;});return h+`</div>${isA?']':'}'}`;}
function swRT(t){document.querySelectorAll('.tab[data-rt]').forEach(b=>b.classList.toggle('active',b.dataset.rt===t));['resp','hdrs','req','snip','expl'].forEach(x=>{const el=document.getElementById('rt-'+x);if(el)el.classList.toggle('hidden',x!==t);});}
function renderSnip(){swSnip(curSnip);}
function swSnip(t){curSnip=t;document.querySelectorAll('[data-st]').forEach(b=>b.classList.toggle('active',b.dataset.st===t));const el=document.getElementById('rSnip');const url=(lastReqI.split('\n')[0]||'https://api.example.com').replace(/^(GET|POST|PUT|DELETE|PATCH)\s+/,'');if(t==='curl')el.textContent=`curl -X GET "${url}" \\\n  -H "Authorization: Bearer YOUR_KEY"`;else if(t==='node')el.textContent=`const res = await fetch("${url}", {\n  headers: { "Authorization": "Bearer " + process.env.API_KEY }\n});\nconsole.log(res.status, await res.json());`;else if(t==='python')el.textContent=`import requests, os\nres = requests.get("${url}",\n  headers={"Authorization": f"Bearer {os.environ['API_KEY']}"})\nprint(res.status_code, res.json())`;else if(t==='ci')el.textContent=`name: API Key Check\non:\n  schedule:\n    - cron: '0 8 * * *'\njobs:\n  check:\n    runs-on: ubuntu-latest\n    steps:\n      - run: |\n          STATUS=$(curl -s -o /dev/null -w "%{http_code}" \\\n            -H "Authorization: Bearer \${{ secrets.API_KEY }}" \\\n            "${url}")\n          [ "$STATUS" = "200" ] || exit 1`;}
function renderExpl(s){const el=document.getElementById('rExpl');const info=ERR_EX[s];if(!info){el.innerHTML=`<div style="padding:12px;background:var(--surface2);border-radius:9px;font-size:11px;color:var(--text2)"><strong>Status ${s||'N/A'}</strong><br>${s?'Check Response tab.':'Request failed ‚Äî likely CORS. Use Snippets tab.'}</div>`;return;}el.innerHTML=`<div style="padding:12px;background:rgba(${info.s==='green'?'34,197,94':info.s==='yellow'?'234,179,8':'239,68,68'},.05);border:1px solid rgba(${info.s==='green'?'34,197,94':info.s==='yellow'?'234,179,8':'239,68,68'},.12);border-radius:9px"><div style="font-size:13px;font-weight:700;margin-bottom:4px">${info.t}</div><div style="font-size:11px;color:var(--text2);line-height:1.5">${info.d}</div></div>`;}

// ===== UTILS =====
function cpClip(t,m){navigator.clipboard.writeText(t).then(()=>toast('‚úÖ',m||'Copied!'));}
function cpSlack(){cpClip(`*API Test*\n‚Ä¢ Status: \`${lastStat}\` ${lastStat>=200&&lastStat<300?'‚úÖ':'‚ùå'}\n‚Ä¢ Via <${SITE_URL}|MDH TESTER>`,'Slack copied!');}
function cpGH(){cpClip(`| Status | \`${lastStat}\` ${lastStat>=200&&lastStat<300?'‚úÖ':'‚ùå'} |\n|---|---|\n> [MDH TESTER](${SITE_URL})`,'GitHub copied!');}
function dlResult(){dl(JSON.stringify({status:lastStat,response:lastRaw,headers:lastHdrs,request:lastReqI,timestamp:new Date().toISOString(),tool:'MDH TESTER v5'},null,2),'mdh-result.json','application/json');toast('üíæ','Exported!');}
function exportPostmanSingle(){const url=(lastReqI.split('\n')[0]||'').replace(/^(GET|POST|PUT|DELETE|PATCH)\s+/,'');dl(JSON.stringify({info:{name:'MDH TESTER',schema:'https://schema.getpostman.com/json/collection/v2.1.0/collection.json'},item:[{name:'Test',request:{method:'GET',header:[{key:'Authorization',value:'Bearer KEY'}],url:{raw:url}}}]},null,2),'mdh-postman.json','application/json');toast('üìÆ','Exported!');}
function dl(c,n,t){const b=new Blob([c],{type:t});const a=document.createElement('a');a.href=URL.createObjectURL(b);a.download=n;a.click();}

// ===== SCANNER =====
function runScan(){const inp=document.getElementById('scanInp').value;if(!inp.trim()){toast('‚ö†Ô∏è','Paste code');return;}const res=document.getElementById('scanRes');res.innerHTML='';let total=0;KEY_PAT.forEach(p=>{const m=inp.match(p.rx);if(!m)return;const u=[...new Set(m)].filter(x=>x.length>=16&&x.length<=200);if(!u.length)return;total+=u.length;res.innerHTML+=`<div class="card" style="padding:10px;margin-bottom:5px"><div class="flex items-center gap-2 mb-2"><span style="font-size:11px;font-weight:700">${p.name}</span><span class="badge badge-red">${u.length}</span></div>${u.slice(0,5).map(k=>`<div class="mono" style="font-size:9px;padding:5px 8px;background:var(--surface2);border-radius:5px;color:var(--text2);cursor:pointer;margin-bottom:3px" onclick="cpClip('${escH(k)}','Copied!')">${escH(mask(k))}</div>`).join('')}${u.length>5?`<div style="font-size:9px;color:var(--text3)">+${u.length-5} more</div>`:''}</div>`;});if(!total)res.innerHTML='<div style="text-align:center;padding:20px;color:var(--green);font-weight:600;font-size:12px">‚úÖ No keys found ‚Äî clean!</div>';else res.innerHTML=`<div style="padding:8px;background:rgba(239,68,68,.05);border:1px solid rgba(239,68,68,.12);border-radius:8px;margin-bottom:10px;font-size:11px;color:var(--red);font-weight:600">üö® ${total} potential keys!</div>`+res.innerHTML;toast(total?'üö®':'‚úÖ',total?total+' keys found':'Clean!');}

// ===== HISTORY =====
function addHist(prov,masked,status,code,lat){hist.unshift({p:prov.name,i:prov.icon,k:masked,s:status,c:code,l:lat,t:new Date().toLocaleString()});if(hist.length>200)hist=hist.slice(0,200);localStorage.setItem('mdhH',JSON.stringify(hist));renderHist();}
function renderHist(){const list=document.getElementById('histList');const emp=document.getElementById('histEmpty');list.innerHTML='';if(!hist.length){emp.classList.remove('hidden');return;}emp.classList.add('hidden');hist.slice(0,50).forEach(h=>{const col={valid:'var(--green)',invalid:'var(--red)',error:'var(--red)',warn:'var(--yellow)'}[h.s]||'var(--text3)';list.innerHTML+=`<div class="card" style="padding:8px 12px"><div class="flex items-center justify-between" style="margin-bottom:2px"><div class="flex items-center gap-2"><span style="font-size:13px">${h.i}</span><span style="font-size:11px;font-weight:600">${h.p}</span></div><span style="font-size:10px;font-weight:700;color:${col}">${h.s}</span></div><div class="flex items-center justify-between"><span class="mono" style="font-size:9px;color:var(--text3)">${h.k}</span><span style="font-size:9px;color:var(--text3)">${h.l?h.l+'ms ':''} ${h.c}</span></div></div>`;});}
function toggleHist(){const p=document.getElementById('histPanel');const o=document.getElementById('histOverlay');const isO=p.classList.contains('open');p.classList.toggle('open',!isO);o.classList.toggle('active',!isO);document.body.style.overflow=isO?'':'hidden';}
function clearHist(){hist=[];stats={t:0,v:0,i:0,l:[]};localStorage.setItem('mdhH','[]');localStorage.setItem('mdhS',JSON.stringify(stats));renderHist();updStats();toast('üóëÔ∏è','Cleared');}
function expHist(){if(!hist.length){toast('‚ö†Ô∏è','Empty');return;}dl('Provider,Key,Status,Code,Latency,Time\n'+hist.map(h=>`"${h.p}","${h.k}","${h.s}","${h.c}","${h.l}","${h.t}"`).join('\n'),'mdh-history.csv','text/csv');toast('üíæ','Exported');}
function updStats(){document.getElementById('stTotal').textContent=stats.t;document.getElementById('stValid').textContent=stats.v;document.getElementById('stInvalid').textContent=stats.i;document.getElementById('stAvg').textContent=stats.l?.length?Math.round(stats.l.reduce((a,b)=>a+b,0)/stats.l.length):0;document.getElementById('stRate').textContent=stats.t?Math.round(stats.v/stats.t*100)+'%':'‚Äî';}

function openModal(id){document.getElementById(id).classList.add('active');}
function closeModal(id){document.getElementById(id).classList.remove('active');}
function shareVia(p){const t=encodeURIComponent('MDH TESTER ‚Äî Test 1000+ API keys! 85+ providers, deep test, bulk mode.');const u=encodeURIComponent(SITE_URL);const urls={twitter:'https://twitter.com/intent/tweet?text='+t+'&url='+u,telegram:'https://t.me/share/url?url='+u+'&text='+t,whatsapp:'https://wa.me/?text='+t+'%20'+u,linkedin:'https://www.linkedin.com/sharing/share-offsite/?url='+u,reddit:'https://reddit.com/submit?url='+u+'&title='+t,email:'mailto:?subject='+t+'&body='+u};if(urls[p])window.open(urls[p],'_blank');closeModal('shareModal');}

let toastT;function toast(ico,msg){const t=document.getElementById('toastEl');document.getElementById('toastIco').textContent=ico;document.getElementById('toastMsg').textContent=msg;t.classList.add('show');clearTimeout(toastT);toastT=setTimeout(()=>t.classList.remove('show'),3000);}

function fireConfetti(){const canvas=document.getElementById('confettiCanvas');const ctx=canvas.getContext('2d');canvas.width=window.innerWidth;canvas.height=window.innerHeight;const pieces=[];const colors=['#22c55e','#6366f1','#f59e0b','#ec4899','#3b82f6','#a855f7'];for(let i=0;i<100;i++)pieces.push({x:canvas.width/2,y:canvas.height/2,vx:(Math.random()-.5)*14,vy:Math.random()*-16-4,w:Math.random()*7+3,h:Math.random()*5+2,color:colors[Math.floor(Math.random()*colors.length)],rot:Math.random()*360,rv:(Math.random()-.5)*10,life:1});let frame=0;function draw(){ctx.clearRect(0,0,canvas.width,canvas.height);let alive=false;pieces.forEach(p=>{if(p.life<=0)return;alive=true;p.x+=p.vx;p.y+=p.vy;p.vy+=0.4;p.vx*=.99;p.rot+=p.rv;p.life-=0.009;ctx.save();ctx.translate(p.x,p.y);ctx.rotate(p.rot*Math.PI/180);ctx.globalAlpha=p.life;ctx.fillStyle=p.color;ctx.fillRect(-p.w/2,-p.h/2,p.w,p.h);ctx.restore();});if(alive&&frame<180){frame++;requestAnimationFrame(draw);}else ctx.clearRect(0,0,canvas.width,canvas.height);}draw();}

init();
</script>
</body>
</html>